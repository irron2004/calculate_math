# Senior Engineer Report — Task 2025-12-02-1

## 1. Context & Planning Alignment
- 기획서는 첫 화면을 “디아블로식 스킬 트리”로 전환하고 모바일 기준 TTI ≤ 3초·초기 렌더 50ms를 OKR로 명시합니다.*(docs/pm/기획안.md:1, docs/pm/기획안.md:10, docs/pm/기획안.md:12)*
- 백엔드 Epic B는 `/api/v1/skills/tree`와 `/api/v1/skills/progress`를 진행도 포함 JSON으로 제공하고 캐시·테스트를 갖추라고 요구합니다.*(docs/pm/기획안.md:45-53)*
- 프런트 Epic C는 팬/줌/키보드 내비, 명확한 상태 배지, 접근성 보장을 필수로 합니다.*(docs/pm/기획안.md:55-62)*

## 2. Backend Snapshot
### 2.1 현재 동작 개요
- FastAPI 앱은 `app/__init__.py`에서 문제/템플릿/그래프/진행도 리포지토리를 수명주기 동안 준비하고 OpenTelemetry 미들웨어·SPA fallback까지 구성되어 있습니다.
- `/api/v1/skills/tree`는 bipartite 그래프와 진행도 스냅샷을 `build_skill_tree_projection`으로 변환해 UI/실험 정보를 내려줍니다.*(app/routers/skills.py:162-223)*

### 2.2 식별된 리스크 & 개선 과제
1. **기본 데이터 패키징 부재**  
   - 설정은 문제·DAG·진행도 파일을 `app/data/*.json` 기본 경로로 기대하지만 저장소에는 `.old` 하위에만 실제 JSON이 있어 런타임 FileNotFound가 발생합니다.*(app/config.py:10-18, app/config.py:133-150)*  
   - ✅ `app/data`로 최신 JSON을 이동하거나 기본 경로를 `.old` 위치로 조정하고, 파일 미존재 시 최소한 seed/fixture로 대체하도록 로더/health 체크를 보강해야 합니다.

2. **Skill UI 그래프 필수 의존성**  
   - `/api/v1/skills/tree`는 `_SKILL_UI_PATH`를 강제하고, 파일이 없으면 즉시 `SkillSpecError`를 던집니다.*(app/routers/skills.py:39-78)*  
   - 현재 저장본에는 `app/data/skills.ui.json`이 없어 API가 graph 없이 빈 payload를 반환합니다. bipartite projection을 그대로 `graph` 필드에 fallback 하거나, UI 그래프를 리포 build 단계에 포함시키는 배포 스크립트가 필요합니다.

3. **진행도 스토어/캐시 옵저버빌리티 부족**  
   - 진행도 로딩 실패 시 단순히 `progress_error` 메시지에 머물고, store가 완전히 비어있으면 첫 번째 user_id를 임의 사용합니다.*(app/routers/skills.py:100-210)*  
   - 기본 데이터가 없을 때의 단계별 fallback과 메트릭(exporter) 을 추가해 root cause 파악을 쉽게 해야 합니다.

4. **인증/세션 보안 미흡**  
   - 로그인은 단순 SHA-256 해시를 사용하고, `SESSION_COOKIE_SECURE` 기본값이 False라 HTTPS가 아닌 환경에서 세션이 노출됩니다.*(app/routers/practice.py:87-101, app/config.py:155-158)*  
   - Argon2/Bcrypt, pepper/iteration 관리, 최소 rate limit을 추가하고 기본 secure/samesite=strict 정책을 강제해야 합니다.

## 3. Frontend Snapshot
### 3.1 현재 구현
- `SkillTreePage`는 API 응답을 기반으로 팬·줌·고대비·포커스 기능을 제공하며, payload에 `skills` 배열만 있을 경우 간이 트리를 그립니다.*(frontend/src/components/SkillTreePage.tsx:285-401)*  
- 에러 발생 시에는 단순 메시지를 표시하고 뒤로가기 링크만 제공됩니다.*(frontend/src/components/SkillTreePage.tsx:381-399)*
- API 클라이언트는 `VITE_SKILL_TREE_MODE`의 기본값을 `live`로 설정해 백엔드 실패 시에는 seed fallback 없이 바로 오류를 노출합니다.*(frontend/src/utils/api.ts:64-96)*

### 3.2 개선 포인트
1. **Seed/Auto Fallback 상시 활성화**  
   - 브라우저가 첫 방문에서 빈 payload를 받으면 기획서의 “첫 화면 스킬 트리” 경험을 제공하지 못합니다. 기본 모드를 `auto-seed`로 바꾸고, API 실패 시 seed 데이터를 즉시 연결해야 합니다.
2. **레이아웃/성능 최적화**  
   - 현재는 백엔드가 내려주는 `graph`가 없으면 매 렌더마다 fallback grid를 재조립합니다.*(frontend/src/components/SkillTreePage.tsx:475-520)*  
   - 백엔드가 precomputed UI 레이아웃을 보장하도록 하거나, 프런트가 React Flow/ELK를 지연 로드하여 TTI ≤ 3초 목표를 지킬 수 있게 해야 합니다.
3. **오류/빈 상태 UX 강화**  
   - 기획서에서 강조한 학습 흐름을 살리려면 에러 카드 대신 seed 그래프/가이드 링크를 노출하고 텔레메트리를 남겨야 합니다.

## 4. Recommended Next Steps
1. **데이터 자산 번들링** – CI/배포 파이프라인에서 `app/data/.old` 내용을 최신 스냅샷으로 승격하고 health-check에서 존재 여부를 검증합니다.
2. **Skill Tree API 탄력성** – `_load_skill_ui_graph` 대신 projection 기반 fallback을 도입하고, graph 버전을 상태에 포함시켜 프런트 캐시를 명확히 합니다.
3. **보안 강화를 위한 인증 리팩터링** – 패스워드 해시 교체, secure 쿠키 기본 적용, `/api/v1/login` rate limiting 및 감사 로그 추가.
4. **프런트 fallback/성능 개선** – `auto-seed` 기본화, 에러/빈 상태 UX 개선, precomputed layout 사용 혹은 React Flow lazy load로 초기 비용 절감.
5. **관측성 및 QA** – 스킬 트리 로딩 실패/seed fallback 사용 여부를 OTEL 메트릭과 GA 이벤트(`skill_tree_fallback`)로 측정하고, QA가 기본 데이터/seed 시나리오를 포함한 회귀를 수행하게 합니다.

이 보고서를 `tasks/2025-12-02-1_handoff.json`과 함께 후속 체인(backend→security→frontend→QA→senior engineer)에 공유해 조치합니다.
