---
workflow: code
graph_profile: end2end
---

# 개발 의뢰서

## 프로젝트명

**수학 지식지도(그래프) 기반 드릴다운 학습 서비스**
(Author Mode: 커리큘럼 그래프 편집/검증/배포 + Student Mode: 그래프 기반 학습/문제풀이/다음 단계 이동)

---

# 1. 프로젝트 개요

## 1.1 서비스 한 문장 요약

**수학 내용을 '지도(그래프)'로 보여주고, 학생은 지도에서 자신의 상태를 확인하며 노드를 따라가며 문제를 풀어 단원을 깊게(Drill-down) 학습하는 서비스**입니다.
관리자(나)는 **개발자 모드(Author Mode)**에서 노드 간 연결을 직접 수정/검증하며 커리큘럼(학습 경로)을 만든 뒤 학생에게 배포합니다.

## 1.2 핵심 가치

* **문제집 방식**: 문제 목록 → 점수
* **본 서비스 방식**: "지식 구조(지도)" → 현재 위치/다음 위치가 보임 → 문제로 통과 → 다음 노드로 이동

## 1.3 초기 범위(콘텐츠)

* **수학**, (콘텐츠는 단계적으로 확장하되) 시스템은 초/중/고 공통 구조를 지원
* 표준 기준: **2022 개정 교육과정** 기반 노드(성취기준 중심)
* 학생 학습 MVP의 1차 목표: **초3 수준에서 덧셈 관련 단원을 drill-down 학습** 가능하게 만들기

> 중요한 원칙: "교육과정 노드(표준/고정)"와 "내가 만드는 학습 경로(연결/가변)"를 분리한다.
> 즉, 노드 자체는 표준 데이터로 고정하고, **학습 연결(선수/다음)을 내가 편집**한다.

---

# 2. 사용자 및 권한

## 2.1 사용자 종류

1. **관리자/설계자(Author)**

* 커리큘럼 그래프 편집(노드 연결)
* 데이터 검증(오류 탐지)
* 학생에게 배포(Publish)

2. **학생(Student)**

* 배포된 그래프를 읽기 전용으로 탐색
* 노드별 문제 풀이(주관식) + 일괄 제출 채점(진단)
* 노드별/전체 학습 상태 확인
* 연결된 다음 노드로 이동하며 학습

## 2.2 권한 규칙

* Author만 그래프 편집 가능
* Student는 **편집 불가(읽기 전용)**
* Student의 진행 기록/정답률은 개인별로 저장

---

# 3. 성공 기준

## 3.1 Author Mode 성공 기준

* 노드 간 연결(선)을 **추가/삭제/방향 변경**할 수 있다.
* 잘못된 연결(순환 등)이 있으면 시스템이 즉시 경고한다.
* "배포 버튼"으로 학생이 볼 버전을 만들 수 있다(스냅샷).

## 3.2 Student Mode 성공 기준

* 학생이 그래프에서 **현재 상태(모름/학습중/마스터)**를 확인할 수 있다.
* 노드를 선택하면 문제를 풀고, **모든 문제 입력 후 제출**하면 평가 페이지에서 정오/정답/진단이 표시된다.
* 문제를 풀면 정답률이 갱신되고, 연결된 "다음 노드"로 자연스럽게 이동한다.
* "덧셈 단원"을 시작해서 하위/연결 노드를 따라가며 drill-down 학습이 가능하다.

---

# 4. 범위 정의 (MVP 포함/제외)

## 4.1 MVP에 포함(필수)

### A) 그래프/노드 시각화

* 트리/그래프 뷰
* 검색/필터
* 노드 상세 패널

### B) Author Mode(편집 기능)

* 엣지(연결) 편집: 추가/삭제/방향 변경
* 엣지 타입 선택(최소 2종)

  * `prereq`(선수/다음 단계)
  * `related`(관련/보조 학습)
* 저장/불러오기
* 검증 리포트(오류 목록 + 점프)

### C) Publish(배포)

* 초안(Draft)과 배포본(Published Version) 분리
* 학생은 **배포본만** 본다

### D) Student Mode(학습 기능)

* 배포된 그래프 읽기 전용 표시
* 노드 상태 표시(모름/학습중/마스터)
* 주관식 문제 입력 + 일괄 제출 채점 + 평가(진단)
* 노드별 정답률 + 전체 정답률 표시
* 다음 노드(연결된 노드) 추천/강조

## 4.2 MVP에서 제외(후순위)

* AI 채점/풀이 과정 평가(식 동치 판정 등)
* 자동 문제 생성
* 고급 추천 알고리즘(적응형 난이도)
* 학부모/교사용 리포트 고도화
* 교과서 출판사별 목차 전체 자동 수집(수동 업로드/매핑은 가능)

---

# 5. 핵심 용어(문서 내 정의)

* **노드(Node)**: 지도 위의 하나의 학습 항목(성취기준/스킬/단원 등)
* **엣지(Edge)**: 노드 간 연결선(학습 순서/관련 관계)
* **prereq 엣지**: A → B (A를 이해해야 B로 이동)
* **related 엣지**: A ↔ B (연관 학습, 필수는 아님)
* **Draft**: 편집 중인 그래프(학생에게 노출 X)
* **Published Version**: 학생에게 공개되는 스냅샷
* **마스터(Mastered)**: 해당 노드 문제 기준을 통과한 상태

---

# 6. 화면/기능 요구사항(상세)

## 6.1 공통 UI 요구

* 상단 메뉴: **Student / Author** 모드 전환(Author는 인증 필요)
* 좌측: 그래프/트리
* 우측: 선택 노드 상세 패널
* 검색창(상단): 노드명/코드/키워드 검색

---

## 6.2 Author Mode 요구사항(개발자 모드)

### 6.2.1 그래프 편집(핵심)

* 노드 클릭 → 상세 패널에 표시:

  * id, label(이름), 설명(text), 메타(학년/영역), 연결된 엣지 목록
* 엣지 추가:

  * 노드 A에서 드래그하여 노드 B에 연결(또는 메뉴로 "A→B 연결")
  * 연결 생성 시 `edgeType` 선택(prereq / related)
* 엣지 삭제:

  * 엣지 클릭 후 삭제 버튼
* 엣지 방향 변경:

  * "방향 반전" 버튼(A→B를 B→A로)
* 엣지 속성 편집:

  * edgeType 변경
  * note(설명) 입력(선택)

#### 완료 기준(DoD)

* 실제로 연결을 추가/삭제/반전한 뒤 저장하면, 새로고침 후에도 그대로 유지된다.
* 학생 모드에서 배포본이 그 연결을 반영하여 "다음 노드"를 보여준다(배포 후).

---

### 6.2.2 검증(Validation) 리포트

Author Mode에서 "검증" 버튼 클릭 시 아래 오류를 탐지하여 목록으로 보여준다.

필수 검증 항목:

1. **순환(Cycle)**: prereq 엣지가 A→…→A 형태로 순환하면 오류
2. **고아 노드(Orphan)**: 루트/코스에서 도달 불가능한 노드(정책에 따라 경고/오류)
3. **중복 ID**
4. **부모-자식 불일치(트리 구조를 쓰는 경우)**

검증 리포트 화면:

* 오류 테이블: (코드 / 노드ID / 메시지 / 심각도)
* 클릭 시 그래프에서 해당 노드를 중앙으로 이동 + 하이라이트

#### 완료 기준(DoD)

* 일부러 사이클을 만들면 리포트가 잡아낸다.
* 리포트 항목 클릭 → 그래프가 그 노드 위치로 이동한다.

---

### 6.2.3 버전/배포(Publish)

* Draft는 계속 수정 가능
* Publish 시:

  * Draft를 복사하여 `GraphVersion` 생성
  * 버전명(예: v2025.12.29) 자동 생성 + 메모 입력(선택)
  * Student Mode는 기본적으로 "최신 Published Version"을 사용

#### 완료 기준(DoD)

* Draft를 수정해도 Student 화면은 변하지 않는다.
* Publish를 누르면 Student 화면이 최신 버전으로 갱신된다.

---

### 6.2.4 데이터 Import/Export

* Import:

  * (최소) JSON 업로드로 노드/엣지/문제 데이터 반영
* Export:

  * 현재 Draft 또는 Published 버전을 JSON으로 다운로드

#### 완료 기준(DoD)

* JSON 한 번 업로드하면 즉시 그래프가 바뀐다.
* Export된 JSON을 다시 Import하면 동일한 그래프가 복원된다.

---

## 6.3 Student Mode 요구사항(학습자 모드)

### 6.3.1 목적(로그인 + 진행 상태 + 문제풀이 + 평가) — 주관식, 일괄 제출 채점

학생이 로그인하면 **최신 Published 그래프 버전**을 로드하고, 학생의 기존 학습 기록을 기반으로 그래프 위에 진행 상태를 오버레이한다.

- 클리어한 노드는 “클리어”로 표시된다.
- 아직 클리어하지 못한 노드는 미클리어로 표시된다.
- **클리어 노드와 연결된 다음 노드**만 “도전하기” 버튼이 활성화된다.
- 연결되지 않은 노드는 **잠김(비활성)** 처리되어 접근이 제한된다.

학생이 노드를 선택(또는 도전하기)하면 해당 노드의 문제를 풀고, **모든 문제를 입력한 뒤 [제출]을 누르면 일괄 채점**한다.
문제 풀이 도중에는 정오/정답을 보여주지 않고, 제출 후에만 **평가(진단) 페이지**에서 결과를 제공한다.

---

### 6.3.2 핵심 사용자 흐름 (Student Mode)

1. 학생 로그인
2. “최신 Published 그래프 버전” 로드
3. 학생의 기존 학습 기록을 불러와 **노드 상태(CLEARED/IN_PROGRESS/AVAILABLE/LOCKED)**를 그래프에 오버레이
4. 학생은 **도전 가능한 노드(AVAILABLE)**를 선택 → 풀이 세션(session) 시작(DRAFT) → 문제 입력 시작
5. 모든 문제 입력 완료 → **[제출]** → 서버에서 일괄 채점 → **평가(진단) 페이지**
6. 채점 결과에 따라 노드 상태가 `CLEARED` 또는 `IN_PROGRESS`로 갱신되고, `CLEARED`가 되면 연결된 다음 노드가 `AVAILABLE`로 해제된다(새로고침 없이 반영).

---

### 6.3.3 노드 상태 정의(필수: 이대로 구현)

노드 상태는 최소 4개로 정의한다(그래프 UI는 색/아이콘/투명도로 표현).

1. **CLEARED (클리어)**
   - 학생이 해당 노드의 “클리어 기준”을 충족한 상태
2. **AVAILABLE (도전 가능)**
   - 아직 클리어는 아니지만 “도전하기” 버튼이 활성화된 상태
3. **LOCKED (잠김)**
   - 아직 접근하면 안 되는 노드(흐림/회색 + 버튼 비활성)
4. **IN_PROGRESS (학습 중)**
   - 풀이 세션을 시작했으나 **아직 제출 전(DRAFT)** 이거나, 제출했으나 클리어 기준 미달(진행 중 표시)

> 중요: 일괄 채점 방식이므로 `IN_PROGRESS`는 “제출 전 상태”가 명확히 존재해야 한다.

---

### 6.3.4 “도전하기 버튼 활성화” 규칙

#### 기본 해제 규칙(필수)

**AVAILABLE 조건** = 아래 중 하나라도 만족하면 도전 가능

1. 해당 노드가 “시작 노드(Start Node)”로 지정되어 있다  
   - 예: prereq가 없는 노드 또는 Author가 `isStart=true`로 지정한 노드
2. **클리어된 노드(CLEARED)와 prereq 엣지로 연결된 노드**  
   - `CLEARED 노드 ->(prereq)-> 대상 노드` 가 존재하면 AVAILABLE

**LOCKED 조건**
- 위 조건을 만족하지 못하면 LOCKED 처리
- UI: 노드 흐림 + “도전하기” 비활성 + 클릭 시 안내 메시지(“선행 노드를 먼저 완료하세요”)

#### (권장) “엄격 모드” 옵션(설계 여지)

MVP는 아래 기본값으로 시작하되, 설정값으로 쉽게 확장 가능한 구조로 설계한다.

- **Simple Unlock (기본)**: 클리어 노드와 연결만 되면 AVAILABLE
- **Strict Prereq (옵션)**: 대상 노드의 모든 prereq 소스 노드가 CLEARED일 때만 AVAILABLE

---

### 6.3.5 그래프 화면 UI 요구사항(학생용)

- 학생 그래프는 **읽기 전용**(엣지 편집/추가 불가)
- 노드 클릭 시 우측 패널(또는 모달)에 노드 정보 표시:
  - 노드명/설명
  - 현재 상태(CLEARED/AVAILABLE/LOCKED/IN_PROGRESS)
  - 내 정답률/진행률 요약(있으면)
  - **도전하기 버튼**: AVAILABLE/IN_PROGRESS일 때 활성(“도전하기/이어하기”)
  - LOCKED면 비활성 + 잠금 사유 표시(“선행 노드를 먼저 완료해야 합니다: [선행 노드명…]”)

시각 표시 규칙(필수):
- CLEARED: 클리어 색상(강조)
- IN_PROGRESS: 중간 강조(테두리/배지)
- AVAILABLE: 클릭/도전 버튼 활성(눈에 띄는 표시)
- LOCKED: 흐림(투명도 낮춤), 클릭 시 안내만(학습 시작 불가)

“클리어와 연결된 노드” 강조:
- 학생이 클리어 노드를 클릭하면 해당 노드에서 나가는 prereq target 노드들을 자동 하이라이트하여 “다음 도전 가능 노드”가 한눈에 보이게 한다.

집중 보기(강력 권장 UX):
- 기본: 선택 노드 주변(선수/다음/관련)만 보여주는 “집중 지도(서브그래프)”
- 버튼: “전체 지도 보기”로 확장

---

### 6.3.6 문제 제공 방식(중요: MVP는 문제은행 기반)

MVP에서는 “AI 생성”이 아니라, **미리 저장된 문제 은행(problem bank)**에서 문제를 가져와 “풀이 세션(Session)”으로 제공한다.

세트 구성 규칙(필수):
- 문제 순서: **고정**
- 문제 수: 노드별 N개(예: 3~10개)
- 학생이 노드를 눌렀을 때:
  - `AttemptSession(DRAFT)`를 생성하고(또는 기존 DRAFT 세션 이어서)
  - 문제 목록을 로드해 입력을 시작한다.

정답 노출 정책(필수, 치팅/노출 방지):
- `GET /student/node/:nodeId/problems`는 **정답(answer)을 내려주지 않는다.**
- 정답/정오/해설(선택)은 **제출 후 결과 응답(또는 result 조회)**에서만 제공한다.

---

### 6.3.7 문제 풀이 화면 요구사항(학생) — 주관식, 일괄 제출

핵심 정책(필수):
- 모든 문제 답은 **주관식 입력**
- 문제를 푸는 도중에는 **정오/정답을 보여주지 않는다**
- 학생이 문제를 **전부 입력한 다음** 마지막에 **[제출] 버튼을 누르면 일괄 채점**한다

권장 UI(구현 난이도/사용성 기준):
- “한 화면에 여러 문제를 폼처럼 나열” (MVP 추천)
  - 제출 전 검토가 쉬움 + 자동저장 UX와 궁합이 좋음

필수 UI 요소:
- 상단: 노드명, 진행 상태(`현재 입력 완료: x / 전체: n`)
- 본문: 고정 순서 문제 리스트 + 문제별 주관식 입력
- 하단:
  - **[제출] 버튼**
    - 기본: “모든 문제에 답이 입력되었을 때만 활성”
    - (옵션) “빈칸 허용 제출”도 가능(빈칸은 오답 처리)
  - **[나가기] 버튼**
    - 나가면 `IN_PROGRESS`로 저장되고 나중에 이어서 풀 수 있어야 함

제출 동작(필수):
- 제출 클릭 → 확인 모달(“제출 후 채점되며 결과가 기록됩니다. 제출하시겠습니까?”)
- 확인 → 서버로 답안 전송 → **일괄 채점 수행** → 결과 수신 후 **평가 화면으로 이동**

---

### 6.3.8 평가(진단) 페이지 요구사항(핵심)

풀이 세션이 **SUBMITTED(제출 완료)** 상태일 때 진입한다(제출 후에만 결과가 존재).

구성(필수):

A) 요약 카드(상단)
- 노드명
- 정답률(%) / 맞은 개수 / 전체 문항 수
- 결과 상태: 기준 통과면 `CLEARED`, 미달이면 `IN_PROGRESS` (옵션: `FAILED` 확장 가능)
- 다음 추천 노드(가능하면 1~3개)

B) 문제별 결과 리스트
- 문제 문구 / 내 답 / 정답 / 정오 표시
- (선택) 오답 문제를 상단에 모아서 표시

C) “이해한 부분 / 막힌 부분” 표현(서비스 핵심)

MVP에서 가장 단순하고 정확한 방식:
- 문제에 “세부 평가 태그(subskillTag)”를 붙인다(문제은행에서 관리).
- 평가 페이지에서 태그별 정답률을 보여준다.
  - 예: `carry_tens`, `carry_hundreds`, `place_value`

D) 다음 학습 행동(CTA)
- “다음 노드 도전하기”(AVAILABLE인 다음 노드로 이동)
- “이 노드 다시 풀기”(재도전 세션 생성 또는 동일 세트 재도전 정책 중 택1)

---

### 6.3.9 진행 상태/정답률 반영 규칙

일괄 채점 방식에서는 “제출 전 답안(DRAFT)”과 “제출 후 결과(SUBMITTED)”가 명확히 분리되어야 한다.

노드 클리어 기준(설정값, MVP 기본):
- 모든 문제 입력 완료 + 제출(SUBMITTED)
- **정답률 ≥ 80%**면 `CLEARED`

상태 갱신 타이밍:
- S2(입력 중): 해당 노드는 `IN_PROGRESS`
- 제출 후:
  - 기준 통과 → `CLEARED`
  - 기준 미달 → `IN_PROGRESS` 유지(옵션: `FAILED` 도입 가능)
- 노드가 `CLEARED`로 바뀌는 순간:
  - 해당 노드에서 나가는 `prereq` 타겟 노드들이 `AVAILABLE`로 갱신
  - 그래프 화면에서 즉시 반영(새로고침 없이)

---

### 6.3.10 데이터/DB/API 요구사항(개발자 구현 기준)

일괄 제출 방식이므로 “제출 전 답안”을 저장할 구조가 반드시 필요하다.

필요 테이블(또는 컬렉션) 최소:
1. `users`
2. `graph_versions` (draft/published, nodes/edges 스냅샷)
3. `problems` (nodeId + order + prompt/grading + answer + tags)
4. `attempt_sessions` (userId + graphVersionId + nodeId + status(DRAFT|SUBMITTED) + startedAt/submittedAt)
5. `responses` (sessionId + problemId + inputRaw/inputNormalized + isCorrect(nullable) + correctAnswerSnapshot + timestamps)
6. (선택) `node_progress` (집계/캐시)

API(최소):
- `POST /auth/login`
- `GET /student/graph/latest`
- `GET /student/progress?graphVersionId=...`
- `GET /student/node/:nodeId/problems`
- `POST /student/node/:nodeId/session/start` (DRAFT 세션 생성/재개 → sessionId 반환)
- `PATCH /student/session/:sessionId/response` (problemId 단위 임시저장; 제출 전 isCorrect는 null)
- `POST /student/session/:sessionId/submit` (일괄 채점; 문제별 정오/정답 + 요약 반환)
- `GET /student/session/:sessionId/result` (새로고침 대비 결과 조회)

예외/엣지 케이스(필수 처리):
1. 첫 로그인(기록 없음): 시작 노드만 AVAILABLE, 나머지 LOCKED
2. 그래프 버전 Publish 업데이트: `graphVersionId` 기준으로 진행 분리 저장(MVP 추천)
3. 잠금 노드 클릭: “왜 잠겼는지” 안내(예: “먼저 [세 자리 덧셈] 노드를 클리어해야 합니다”)

---

### 6.3.11 학생 인수 시나리오(필수)

시나리오 A: 상태 표시/잠금 규칙
1. 학생 로그인
2. 그래프에서 클리어 노드는 CLEARED 표시
3. 클리어 노드와 prereq로 연결된 노드만 “도전하기” 활성(AVAILABLE)
4. 연결되지 않은 노드는 흐림 + 비활성(LOCKED)

시나리오 B: 문제 풀이→평가
1. AVAILABLE 노드 클릭 → 도전하기 → 문제 세트 시작
2. 문제 n개 주관식 입력(풀이 중 정오/정답 표시 없음)
3. [제출] 클릭 → 확인 → 일괄 채점
4. 평가 페이지에서 문제별 정오/정답/요약/태그별 분석이 표시
5. 기준 통과 시 그래프에서 노드가 CLEARED로 바뀌고 다음 노드가 AVAILABLE로 활성화

---

# 7. 데이터 설계(코드에 넣을 형태)

> 개발자는 아래 JSON 구조를 기준으로 DB/파일 저장을 구현한다.
> 초기에는 JSON Import/Export로 운영 가능해야 하며, DB로 전환해도 구조가 유지되어야 한다.

## 7.1 노드(Node)

필수 필드:

* `id`: string (유니크)
* `nodeType`: `"curriculum" | "skill" | "unit" | "root"` (MVP는 curriculum+root만 있어도 됨)
* `label`: string (화면 표시명)
* `text`: string|null (설명/성취기준 문장)
* `meta`: 객체(학년군/영역/태그 등)
* `order`: number|null (고정 순서/정렬용)

예시:

```json
{
  "id": "E-3-ADD-001",
  "nodeType": "skill",
  "label": "세 자리 수 덧셈(받아올림 포함)",
  "text": "세 자리 수 덧셈을 받아올림 포함하여 계산할 수 있다.",
  "meta": { "level": "E", "gradeBand": "3-4", "domain": "NA", "tags": ["addition"] },
  "order": 103
}
```

## 7.2 엣지(Edge)

필수 필드:

* `id`: string
* `edgeType`: `"prereq" | "related" | "contains"`
* `source`: nodeId
* `target`: nodeId
* `note`: string|null

예시:

```json
{
  "id": "edge-001",
  "edgeType": "prereq",
  "source": "E-3-ADD-001",
  "target": "E-3-ADD-002",
  "note": "받아올림 없는 덧셈 다음"
}
```

## 7.3 그래프 버전(GraphVersion)

* `graphId`
* `status`: `"draft" | "published"`
* `createdAt`
* `publishedAt`
* `nodes[]`
* `edges[]`
* `problemSetVersionId`(문제 세트 버전과 연결 가능)

## 7.4 문제(Problem)

필수:

* `problemId`
* `nodeId`(어떤 노드 문제인지)
* `order`(고정)
* `prompt`
* `grading` (채점 규칙)
* `answer`

예시:

```json
{
  "problemId": "P-ADD-0001",
  "nodeId": "E-3-ADD-001",
  "order": 1,
  "prompt": "345 + 270 = ?",
  "grading": { "mode": "numeric_equal", "normalize": ["trim", "removeSpaces", "removeCommas"] },
  "answer": { "type": "number", "value": "615", "tolerance": 0 }
}
```

## 7.5 풀이 세션/답안(AttemptSession/Response)

일괄 제출 채점 방식에서는 “제출 전 답안(DRAFT)”과 “제출 후 결과(SUBMITTED)”를 분리해 저장한다.

### AttemptSession

필수:

* `sessionId`
* `userId`
* `graphVersionId`
* `nodeId`
* `status`: `"DRAFT" | "SUBMITTED"`
* `startedAt`
* `submittedAt`(optional, SUBMITTED일 때)

### Response

필수:

* `responseId`
* `sessionId`
* `problemId`
* `inputRaw`
* `inputNormalized`
* `isCorrect`: boolean|null (제출 전에는 null, 제출 후 true/false)
* `correctAnswerSnapshot` (제출 후 결과 화면 표시용)
* `createdAt`
* `updatedAt`

---

# 8. 기술/구현 제안(개발자 참고)

## 8.1 프론트엔드

* Web: React + TypeScript
* 그래프: **React Flow**
* 자동 레이아웃: **dagre**
* 상태 관리: Zustand 또는 Redux(팀 선호)
* UI: 간단한 컴포넌트 라이브러리(선택)

## 8.2 백엔드/저장(권장 옵션)

학생이 존재하고 데이터가 지속돼야 하므로 **저장소는 반드시 필요**합니다.

* MVP 옵션 A(가장 단순):

  * 서버 없이 브라우저 localStorage
  * 단점: 여러 학생/여러 기기에서 사용 어려움(서비스화 어려움)

* MVP 옵션 B(권장):

  * 간단한 API + DB(초기 SQLite → 추후 Postgres)
  * 그래프 버전/학생 기록 저장 가능
  * Author 편집/배포가 안정적

> 의뢰 범위는 "옵션 B"를 기준으로 개발을 권장합니다.
> (서비스 목적상 학생 기록이 서버에 남아야 운영이 가능)

---

# 9. 개발 마일스톤(순서 기반 일정)

> 날짜/기간이 아니라 "완료 조건 기반"으로 제시합니다.

## M0) 기반 구축

* 프로젝트 세팅, 라우팅, 권한(Author/Student) 분리
* JSON 스키마 확정 및 샘플 데이터로 렌더링

## M1) 그래프 뷰어 완성

* 트리/그래프 화면 + 검색 + 노드 상세

## M2) Author 편집 기능 완성

* 엣지 추가/삭제/방향 변경 + 저장
* 검증 리포트 + 점프/하이라이트

## M3) Publish(버전) 완성

* Draft/Published 분리
* 학생은 Published만 조회

## M4) 문제/채점/정답률 완성

* 주관식 입력 + 일괄 제출 채점(평가/진단)
* 노드별/전체 정답률 표시
* 노드 상태(모름/학습중/마스터)

## M5) Drill-down 흐름 완성

* 집중 보기(서브그래프)
* 다음 노드 추천/강조
* "덧셈 단원" 학습 루프 완주 가능

---

# 10. 인수 기준(최종 체크리스트)

개발 완료 시 아래를 실제로 시연 가능해야 함:

## Author 시연

1. 그래프에서 노드 A→B prereq 연결 생성
2. 사이클을 만들면 검증 리포트에 표시
3. 사이클을 해소하면 리포트가 깨끗해짐
4. Publish 후 학생 화면에서 "다음 노드"가 그 연결대로 보임

## Student 시연

1. 덧셈 노드 선택 → 문제 3개 주관식 입력(풀이 중 정오/정답 표시 없음)
2. 모든 문제 입력 후 [제출] → 일괄 채점
3. 평가 페이지에서 정오/정답/요약/태그별(선택) 분석이 표시
4. 통과하면 그래프에서 노드가 CLEARED로 바뀌고 다음 노드가 AVAILABLE로 활성화

---

# 11. 향후 발전 방향(서비스 관점, 후속 버전)

1. **코스(학습 루트) 기능**

* 그래프 전체가 아니라 "덧셈 마스터 코스"처럼 부분 그래프를 코스로 제공
* 학생은 길을 잃지 않음

2. **진단(시작점 추천)**

* 초기 5~10문제로 시작 노드 자동 추천

3. **복습 큐(망각 방지)**

* 마스터한 노드도 시간이 지나면 복습 노드로 다시 제시

4. **부모/교사용 요약 리포트**

* "어디가 약한지/다음은 무엇인지" 자동 요약

---

# Author Mode 백로그 (M0~M3) — 30 Tickets

## 마일스톤 개요

* **M0 기반 구축**: 앱 골격/권한/데이터 타입/로딩
* **M1 뷰어 완성**: 트리/그래프/검색/상세/레이아웃/점프
* **M2 편집+검증 완성**: 엣지 편집(추가/삭제/반전/편집) + 검증 리포트 + 점프
* **M3 배포(버전) 완성**: Draft/Published 분리 + Publish + Preview

> 용어(간단)

* **노드(Node)**: 성취기준/스킬 같은 학습 항목(점)
* **엣지(Edge)**: 노드 간 연결(선)
* **Draft**: 편집 중인 그래프(학생 공개 X)
* **Published**: 배포된 그래프(학생 공개 O)
* **edgeType**: `prereq(선수/다음)` / `related(관련)`

---

## 공통 티켓 규칙(모든 티켓의 DoD 기본)

* 기능이 실제 UI에서 **클릭으로 확인 가능**해야 함
* 콘솔 에러 없이 동작
* 저장/로드 포함 티켓은 **새로고침 후에도 유지**되어야 함
* "오류 상황(데이터 깨짐 등)"에서 사용자에게 **이유가 보이는 메시지**가 나와야 함

---

# M0 — 기반 구축

## AU-001 프로젝트 세팅 및 기본 품질 도구

* **우선순위**: P0
* **목적**: 개발이 꼬이지 않게 기본 뼈대/규칙부터 고정
* **작업 내용**

  * React + TypeScript 프로젝트 생성
  * ESLint/Prettier 설정, 기본 스크립트 정리
  * dev/prod 빌드 확인
* **DoD**

  * 로컬에서 실행/빌드가 정상
  * 린트/포맷이 일관되게 적용됨
* **의존성**: 없음

---

## AU-002 라우팅 및 공통 레이아웃(Author 중심)

* **우선순위**: P0
* **목적**: 개발자가 "어디에 무엇이 있는지" 고정된 구조 확보
* **작업 내용**

  * 페이지 3개 생성

    * `/author/graph` (편집 그래프)
    * `/author/health` (검증 리포트)
    * `/author/published-preview` (배포본 미리보기)
  * 공통 레이아웃: 상단 탭(그래프/검증/미리보기), 우측 상세 패널 영역
* **DoD**

  * 탭으로 세 페이지 이동 가능
  * 공통 레이아웃 유지(헤더/패널)
* **의존성**: AU-001

---

## AU-003 Author 인증(간단 가드) + 로그아웃

* **우선순위**: P0
* **목적**: 학생 모드와 분리되는 "나만 편집 가능한 모드" 확보
* **작업 내용**

  * Author 진입 시 간단 인증(예: 비밀번호/토큰 입력)으로 접근 제어
  * 인증 성공 시 세션 유지(브라우저 저장소 기반)
  * 로그아웃 버튼 제공
* **DoD**

  * 인증 없이는 `/author/*` 접근 불가
  * 인증 후 새로고침해도 유지
* **의존성**: AU-002

---

## AU-004 알림/에러 처리(Toast + ErrorBoundary)

* **우선순위**: P0
* **목적**: 데이터 깨짐/저장 실패 등에서 "왜 안 되는지" 사용자에게 보여줌
* **작업 내용**

  * Toast(성공/실패/경고) 유틸
  * ErrorBoundary 적용(치명적 에러 시 안내 화면)
* **DoD**

  * JSON 로딩 실패/저장 실패 시 화면에서 오류 메시지 확인 가능
* **의존성**: AU-001

---

## AU-005 데이터 스키마/타입 정의(스키마 버전 포함)

* **우선순위**: P0
* **목적**: 데이터 구조가 바뀌어도 프로젝트가 무너지지 않게 "표준 계약"을 만든다
* **작업 내용**

  * TS 타입 정의:

    * `Node`, `Edge`, `GraphDraft`, `GraphVersion`, `ValidationResult`
  * `schemaVersion` 필드 도입(향후 호환 대비)
  * edgeType 정의: `prereq | related` (MVP)
* **DoD**

  * 타입 기반으로 컴파일 에러 없이 동작
  * 샘플 JSON이 타입 검증을 통과
* **의존성**: AU-001

---

## AU-006 성취기준 노드 데이터 로딩(JSON) + 실패 UI

* **우선순위**: P0
* **목적**: "표준 노드(성취기준)"를 화면에 띄우는 파이프라인 확보
* **작업 내용**

  * `public/data/curriculum_math_2022.json` 로드
  * 로딩 상태(스피너), 실패 시 재시도 버튼/오류 메시지
* **DoD**

  * 샘플 노드(150~200개)가 로드되어 화면에서 개수 표시 가능
* **의존성**: AU-004, AU-005

---

## AU-007 GraphStore(상태 관리) 구축

* **우선순위**: P0
* **목적**: 선택 노드/선택 엣지/편집 상태를 한 곳에서 관리해 꼬임 방지
* **작업 내용**

  * 전역 스토어(선호 툴 자유: Zustand/Redux 등)
  * 상태 항목:

    * `nodes`(읽기 전용), `edgesDraft`(편집 대상)
    * `selectedNodeId`, `selectedEdgeId`
    * `ui: filters, searchQuery, focusNodeId`
    * `dirty`(저장 안 됨 여부)
* **DoD**

  * 노드 선택/검색/필터 상태가 페이지 전환 후에도 유지(원하면 유지)
* **의존성**: AU-006

---

## AU-008 인덱싱/검색 유틸(Map + 키워드 검색)

* **우선순위**: P0
* **목적**: 노드가 많아도 빠르게 찾기(운영 핵심)
* **작업 내용**

  * `nodeById: Map`
  * 간단 검색 인덱스(예: label/text 포함 검색)
  * "검색 결과 리스트" 생성 유틸
* **DoD**

  * 검색어 입력 시 결과가 즉시(체감상) 갱신
* **의존성**: AU-006, AU-007

---

# M1 — 뷰어 완성(트리/그래프/레이아웃/점프)

## AU-009 Tree View 렌더(접기/펼치기) + 선택 연동

* **우선순위**: P0
* **목적**: 큰 구조를 빠르게 훑는 탐색 UI 제공
* **작업 내용**

  * parentId 기반 트리 렌더(접기/펼치기)
  * 노드 클릭 시 `selectedNodeId` 업데이트
* **DoD**

  * 트리에서 노드를 클릭하면 상세 패널이 바뀜
* **의존성**: AU-007

---

## AU-010 필터 UI(학년군/영역) + 검색 UI

* **우선순위**: P0
* **목적**: 200노드에서 "내가 보고 싶은 부분만" 보게 하기
* **작업 내용**

  * 필터: gradeBand(1-2/3-4/5-6), domain(NA/GE/ME/DA 등)
  * 검색: ID/label/text
* **DoD**

  * 필터 적용 시 트리/그래프 모두 동일 범위로 좁혀짐
* **의존성**: AU-008, AU-009

---

## AU-011 Node 상세 패널(메타/경로/연결 목록)

* **우선순위**: P0
* **목적**: "이 노드가 무엇이고 어디에 속하는지" 한눈에 보기
* **작업 내용**

  * 표시 항목: id, label, text, meta(학년군/영역/태그)
  * breadcrumb(루트→현재)
  * 연결 목록(들어오는 prereq / 나가는 prereq / related)
* **DoD**

  * 노드 클릭 시 상세 패널 정보가 정확히 갱신됨
* **의존성**: AU-007, AU-008

---

## AU-012 Graph View 기본 렌더(React Flow)

* **우선순위**: P0
* **목적**: "지도(그래프)" 화면의 기본 동작 확보
* **작업 내용**

  * nodes + edgesDraft를 React Flow 노드/엣지로 변환 렌더
  * pan/zoom 기본 동작
  * 노드 클릭 시 선택 연동
* **DoD**

  * 그래프에서 노드가 보이고 클릭으로 상세가 바뀜
* **의존성**: AU-007

---

## AU-013 자동 레이아웃(dagre) 적용

* **우선순위**: P0
* **목적**: 노드가 많아도 구조가 "읽히는" 배치 제공
* **작업 내용**

  * dagre로 TB(top-bottom) 레이아웃
  * 레이아웃 실행 조건: 초기 로딩/필터 변경 시 1회
* **DoD**

  * 페이지 진입 시 자동 정렬
  * 불필요하게 매 렌더마다 레이아웃 재실행되지 않음
* **의존성**: AU-012

---

## AU-014 노드 타입별 스타일 + 하이라이트(기본)

* **우선순위**: P1
* **목적**: 시각적으로 "구분/상태"가 보여야 검증이 쉬움
* **작업 내용**

  * nodeType(예: domain/achievement 등) 별 스타일(테두리/배지)
  * 선택 노드 강조
* **DoD**

  * 타입별로 구분되고 선택 노드가 눈에 띔
* **의존성**: AU-012

---

## AU-015 Focus/Jump 기능(노드ID로 센터링)

* **우선순위**: P0
* **목적**: 리포트/검색 결과에서 "바로 그 위치로 이동"이 되어야 실사용 가능
* **작업 내용**

  * `focusNodeId`가 있으면 그래프에서 해당 노드로 이동(setCenter/fitView)
  * URL 파라미터 지원: `/author/graph?focus=NODE_ID`
* **DoD**

  * 검색 결과 클릭 → 그래프가 해당 노드로 센터링
* **의존성**: AU-012

---

## AU-016 200노드 성능 최적화(체감 개선)

* **우선순위**: P1
* **목적**: 150~200개에서 끊김 없이 편집 가능
* **작업 내용**

  * React Flow node/edge memoization
  * 트리 렌더 최적화(필요 시 간단 가상화)
* **DoD**

  * 드래그/줌/선택이 체감상 버벅이지 않음(테스트 기준: 200노드)
* **의존성**: AU-012, AU-013

---

# M2 — 편집 + 검증(Author 핵심)

## AU-017 엣지 생성(드래그 연결) 활성화

* **우선순위**: P0
* **목적**: "노드 간 연결을 바꿔가며 커리큘럼 만들기"의 시작점
* **작업 내용**

  * 노드 핸들(출발/도착)로 연결 생성
  * 생성된 엣지는 edgesDraft에 추가
* **DoD**

  * A에서 B로 드래그 연결하면 선이 생기고 저장 대상에 반영됨
* **의존성**: AU-012, AU-007

---

## AU-018 엣지 생성 시 edgeType 선택 UI

* **우선순위**: P0
* **목적**: "선수(prereq)"와 "관련(related)" 구분이 서비스 핵심
* **작업 내용**

  * 연결 생성 시 팝업/패널에서 타입 선택
  * 기본값: prereq
* **DoD**

  * edgeType이 저장되고, 스타일이 타입별로 구분됨(예: 선 모양/라벨)
* **의존성**: AU-017

---

## AU-019 엣지 선택/삭제(확인 모달 포함)

* **우선순위**: P0
* **목적**: 연결을 쉽게 정리/수정 가능해야 함
* **작업 내용**

  * 엣지 클릭 시 선택 상태
  * 삭제 버튼 + 확인 모달
* **DoD**

  * 삭제 후 즉시 그래프에서 사라지고 dirty 상태가 됨
* **의존성**: AU-017

---

## AU-020 엣지 방향 반전(Flip)

* **우선순위**: P1
* **목적**: prereq 방향은 자주 바뀌므로 "반전"이 생산성에 중요
* **작업 내용**

  * 선택된 엣지에 대해 source/target 스왑
* **DoD**

  * 클릭 한 번으로 A→B가 B→A로 바뀜
* **의존성**: AU-019

---

## AU-021 엣지 속성 편집 패널(type/note)

* **우선순위**: P1
* **목적**: 연결의 의미를 기록/변경 가능해야 유지보수가 쉬움
* **작업 내용**

  * 엣지 선택 시 우측 패널에서:

    * edgeType 변경
    * note 입력(왜 연결했는지)
* **DoD**

  * note가 저장되고 새로고침 후에도 유지
* **의존성**: AU-019

---

## AU-022 편집 제한 규칙 적용(안전장치)

* **우선순위**: P0
* **목적**: "표준 노드 구조"는 건드리지 않고 "학습 경로(prereq/related)"만 편집하게
* **작업 내용**

  * 금지 규칙:

    * 동일 source-target-edgeType 중복 생성 금지
    * 자기 자신으로 연결 금지(A→A)
  * (옵션) 특정 nodeType 간 연결 제한(예: root/gradeBand 등은 prereq 금지)
* **DoD**

  * 금지 케이스를 시도하면 생성이 막히고 이유가 안내됨
* **의존성**: AU-017, AU-004

---

## AU-023 Undo/Redo(엣지 작업 한정) + 단축키

* **우선순위**: P1
* **목적**: 편집은 시행착오가 필수라 "되돌리기"가 없으면 실사용이 어렵다
* **작업 내용**

  * 엣지 add/delete/flip/typeChange를 Undo/Redo 스택으로 관리
  * 단축키: Ctrl+Z / Ctrl+Y(또는 Ctrl+Shift+Z)
* **DoD**

  * 엣지 작업이 최소 10단계까지 되돌리기 가능
* **의존성**: AU-017~AU-021

---

## AU-024 Dirty State(저장 안 됨) 표시

* **우선순위**: P0
* **목적**: "저장했는지" 헷갈려서 작업이 꼬이는 걸 방지
* **작업 내용**

  * 편집 발생 시 상단에 "저장 안 됨" 배지 표시
  * 저장 성공 시 배지 해제
* **DoD**

  * 엣지 1개만 바꿔도 상태가 확실히 표시됨
* **의존성**: AU-017, AU-028(저장 기능 전이라도 상태 표시는 선 구현 가능)

---

## AU-025 검증 엔진 v1 구현(학습 엣지 중심)

* **우선순위**: P0
* **목적**: 잘못 연결된 그래프를 자동으로 잡아 "내가 검증"할 수 있게
* **검증 대상**: **prereq 엣지** 중심(related는 경고 수준 가능)
* **검증 규칙(최소)**

  * Cycle: prereq 사이클 탐지(오류)
  * Orphan(정책 선택): 시작점(루트/코스)에서 도달 불가 노드(경고)
  * Duplicate edge: 중복 엣지(오류)
  * Missing node: 엣지가 존재하지만 노드가 없음(오류)
* **DoD**

  * 사이클을 만들면 검증 결과에 반드시 뜸
  * 노드 없는 엣지(불량 데이터)도 탐지됨
* **의존성**: AU-005, AU-007

---

## AU-026 Health Report 화면(검증 결과 테이블)

* **우선순위**: P0
* **목적**: 문제를 "리스트로" 보여줘야 실제로 고칠 수 있음
* **작업 내용**

  * `/author/health`에서 검증 결과 출력
  * 필터: error만 보기 / code별 필터
* **DoD**

  * 검증 결과가 표로 보이고 필터가 동작함
* **의존성**: AU-025

---

## AU-027 Health → Graph 점프 + 하이라이트

* **우선순위**: P0
* **목적**: "오류 클릭 → 그 위치로 이동"이 되어야 편집 속도가 나옴
* **작업 내용**

  * 리포트 항목 클릭 시 `/author/graph?focus=NODE_ID` 이동
  * 그래프에서 해당 노드 하이라이트(선택 강조)
* **DoD**

  * 리포트 클릭하면 그래프가 그 노드로 이동하고 눈에 띄게 강조됨
* **의존성**: AU-015, AU-026

---

# M3 — 저장/가져오기/배포(버전)

## AU-028 Draft 저장/불러오기(로컬 저장 + 자동저장 옵션)

* **우선순위**: P0
* **목적**: Author 작업이 "날아가지 않게" 하는 최소 운영 장치
* **작업 내용**

  * Draft edges 저장(브라우저 저장소 기반)
  * "저장" 버튼(수동 저장)
  * (선택) 자동 저장 토글(예: 5초 디바운스)
* **DoD**

  * 엣지를 편집하고 저장 → 새로고침 후에도 유지
  * 저장 성공/실패 Toast 표시
* **의존성**: AU-024, AU-004

---

## AU-029 Import/Export(JSON)

* **우선순위**: P0
* **목적**: 데이터 이동/백업/공유/대량 편집을 가능하게 함
* **작업 내용**

  * Export: Draft를 JSON 다운로드
  * Import: JSON 업로드로 Draft 교체(기본은 "전체 교체")
  * Import 전에 validation 실행 → 치명 오류 시 적용 금지 + 메시지
* **DoD**

  * Export→Import 하면 그래프가 동일하게 복원됨
  * 잘못된 JSON은 거부되고 이유가 표시됨
* **의존성**: AU-025, AU-004, AU-028

---

## AU-030 Publish/버전 스냅샷 + Published Preview

* **우선순위**: P0
* **목적**: "초안 편집"과 "학생 공개 버전"을 분리(운영 핵심)
* **작업 내용**

  * Publish 버튼:

    * Draft edges를 복사하여 `GraphVersion` 생성(버전ID, createdAt)
    * "현재 Published = 최신 버전"으로 설정
  * `/author/published-preview`:

    * Published 버전을 **읽기 전용**으로 그래프 렌더
    * Draft와 시각적으로 구분("배포본 보기" 표기)
* **DoD**

  * Draft를 수정해도 Published Preview는 바뀌지 않음
  * Publish 후 Published Preview가 새 버전으로 갱신됨
* **의존성**: AU-028, AU-012, AU-013

---

# 에픽 요약(PM용)

* **기반(M0)**: AU-001 ~ AU-008
* **뷰어(M1)**: AU-009 ~ AU-016
* **편집/검증(M2)**: AU-017 ~ AU-027
* **저장/배포(M3)**: AU-028 ~ AU-030
* **학생(M4)**: ST-001 ~ ST-015
* **학생(M5)**: ST-016 ~ ST-030

---

# 구현 시 "반드시 지켜야 할 핵심 원칙(꼬임 방지)"

1. **노드는 기본적으로 읽기 전용**(성취기준 데이터는 "지도 바탕"이므로 자주 수정하면 꼬임)
2. Author가 편집하는 건 **학습 엣지(prereq/related)** 중심
3. **Draft와 Published는 완전히 분리**(배포 전 테스트/편집이 가능해야 운영 가능)
4. Validation은 "기능"이 아니라 **필수 안전장치**(사이클 탐지는 무조건)

---

# M4 — Student Mode: 로그인 + 상태 오버레이 + 문제/채점 + 평가(진단)

> 목표: “학생 로그인 → 도전 가능한 노드만 활성 → 문제풀이 → 평가 페이지 → 다음 노드 이동”의 최소 루프를 완성한다.

## ST-001 Student 라우팅/레이아웃(읽기 전용 그래프 기본 틀)

* **우선순위**: P0
* **목적**: Student Mode의 진입점/동선/레이아웃을 먼저 고정
* **작업 내용**

  * Student 페이지 라우팅 추가(예시)

    * `/student/login`
    * `/student/graph`
    * `/student/session/:sessionId/learn` (문제풀이: 입력/임시저장)
    * `/student/session/:sessionId/eval` (평가/결과)
  * 공통 레이아웃: 그래프 영역 + 우측 패널(노드 상세/도전하기)
  * 모드 전환 UI(Author/Student) 기본 제공(Author는 인증 필요)
* **DoD**

  * Student 화면에 진입 가능하고, 각 라우트가 최소 placeholder로 렌더됨
  * Student 그래프는 편집 불가(읽기 전용)
* **의존성**: AU-002

---

## ST-002 Student 로그인(UI) + 세션 유지

* **우선순위**: P0
* **목적**: 학생별 진행 상태 저장을 위한 사용자 식별 기반 확보
* **작업 내용**

  * 로그인 폼(email/password 또는 단순 토큰) 구현
  * 로그인 성공 시 세션 유지(예: httpOnly cookie 또는 토큰 저장소)
  * 로그아웃 버튼 제공
* **DoD**

  * 로그인 전에는 `/student/*` 접근 시 `/student/login`으로 리다이렉트
  * 로그인 후 새로고침해도 세션 유지
* **의존성**: ST-001, ST-003

---

## ST-003 Auth API: `users` + `POST /auth/login`

* **우선순위**: P0
* **목적**: Student Mode에서 API 호출을 사용자 단위로 묶기
* **작업 내용**

  * `users` 테이블(또는 컬렉션) 추가
  * `POST /auth/login` 구현(간단한 password 방식 또는 OAuth stub)
  * 인증 실패/만료 시 표준 에러 응답 정의
* **DoD**

  * 로그인 성공/실패 케이스가 명확한 에러 코드/메시지로 구분됨
  * Student API 호출이 사용자 컨텍스트에서 동작(최소: userId 식별)
* **의존성**: (백엔드 기반 구축)

---

## ST-004 Student 그래프 로드: 최신 Published 조회 API 정리

* **우선순위**: P0
* **목적**: “최신 Published 그래프 버전”을 Student가 안정적으로 로드
* **작업 내용**

  * `GET /student/graph/latest` (또는 기존 `/api/graph/published`를 Student 표준으로 래핑)
  * 응답에 `graphVersionId` 포함(버전 단위로 progress 분리 저장하기 위함)
  * 로딩/404/에러 처리 UI 추가
* **DoD**

  * Student 그래프 화면이 최신 published를 로드해 렌더링 가능
  * 버전 ID가 응답에 포함되어야 함
* **의존성**: AU-030, ST-001

---

## ST-005 문제 콘텐츠 스키마 확정(Problem: promptFormat/tags/grading) + 고정 order

* **우선순위**: P0
* **목적**: 평가(진단) 페이지에서 “어디서 막혔는지”를 태그로 설명
* **작업 내용**

  * `Problem` 필드 확정
    * `problemId`, `nodeId`, `order`, `prompt`, `promptFormat`, `grading`, `answer`, `tags[]`
  * `promptFormat` 최소 지원
    * `"plain"`: 일반 텍스트
    * `"latex"`: 수식 포함(렌더는 ST-013에서 UI 처리)
  * 샘플 문제 데이터(Seed)
    * 최소 20문항(태그 포함)
    * `promptFormat="latex"` 문제를 최소 3문항 포함
  * `problems`에 `tags: string[]`(= subskillTag) 필드 추가
  * 문제는 `nodeId + order`로 고정 순서를 보장
  * 샘플 문제 데이터에 최소 2~3개 tag를 실제로 포함(덧셈 예시)
  * **정답 노출 방지**: problems 조회 API는 정답을 포함하지 않도록 설계(정답은 제출 후 결과에서만 제공)
* **DoD**

  * `GET /student/node/:nodeId/problems`가 tags 포함 문제를 반환
  * `GET /student/node/:nodeId/problems` 응답에는 `answer`가 포함되지 않는다
  * order가 안정적으로 유지됨(재호출 시 순서 동일)
  * 프론트에서 문제 목록을 렌더하고(정답 없이), 입력/임시저장/제출까지 end-to-end로 동작 가능
* **의존성**: (문제 데이터/스키마)

---

## ST-006 채점 엔진 v1(숫자 답 중심) + 정규화

* **우선순위**: P0
* **목적**: 일괄 제출 채점 결과를 안정적으로 제공(꼬임 방지)
* **작업 내용**

  * `numeric_equal` 채점 구현
  * 정규화: trim, removeSpaces(옵션), removeCommas, (가능하면) 전각 숫자 처리
  * 파싱 실패 정책 결정 및 메시지 고정(“숫자로 입력해 주세요”)
* **DoD**

  * 같은 값 표현(예: `" 7 "`, `"7"`, `"1,000"`)이 정상 채점됨
  * 실패 시에도 사용자 메시지가 명확함
  * 채점/정규화 유닛 테스트 20개 이상 자동화(공백/쉼표/전각 숫자/파싱 실패 포함)
* **의존성**: ST-005

---

## ST-007 풀이 세션/답안 저장 + 제출/결과 API (일괄 채점)

* **우선순위**: P0
* **목적**: 제출 전 답안(DRAFT)을 안전하게 저장하고, 제출 시 1회 일괄 채점 후 결과를 재조회 가능하게 만든다
* **작업 내용**

  * `attempt_sessions` 테이블 추가
    * userId, graphVersionId, nodeId, status(DRAFT|SUBMITTED), startedAt, submittedAt
  * `responses` 테이블 추가
    * sessionId, problemId, inputRaw, inputNormalized, isCorrect(nullable), correctAnswerSnapshot, createdAt/updatedAt
  * API 구현
    * `POST /student/node/:nodeId/session/start`
      - DRAFT 세션이 있으면 재사용, 없으면 생성
    * `PATCH /student/session/:sessionId/response`
      - problemId 단위로 답안 임시 저장(정규화 포함)
      - 제출 전 isCorrect는 null
    * `POST /student/session/:sessionId/submit`
      - 전체 문제 일괄 채점
      - session.status=SUBMITTED로 전환 + submittedAt 기록
      - responses에 isCorrect/correctAnswerSnapshot 채움
      - 요약(정답률/맞은 개수/전체 문항/통과 여부) + 문제별 결과 반환
    * `GET /student/session/:sessionId/result`
      - 새로고침 대비 제출 결과 재조회(요약 + 문제별 + tag별)
  * 정책 고정(필수)
    * 제출 전에는 정답/정오를 클라이언트에 내려주지 않는다
    * 제출 후에는 responses의 스냅샷을 기준으로 결과 페이지가 렌더 가능해야 한다
* **DoD**

  * 세션 시작 → 임시 저장 → 페이지 새로고침 후에도 입력이 복원됨
  * 제출 후 결과 API로 동일 결과를 다시 조회 가능
  * 제출 전 문제 조회 API(`GET /student/node/:nodeId/problems`)에는 정답이 포함되지 않음
* **의존성**: ST-003, ST-004, ST-005, ST-006

---

## ST-008 노드 진행 상태 계산: `GET /student/progress` (세션 기반)

* **우선순위**: P0
* **목적**: 그래프에 노드 상태(CLEARED/IN_PROGRESS/AVAILABLE/LOCKED)를 오버레이
* **작업 내용**

  * 노드별 status/accuracy/lastAttemptAt 계산 로직 구현(세션 기반)
    * `IN_PROGRESS`: DRAFT 세션이 존재하거나, SUBMITTED지만 클리어 기준 미달
    * `CLEARED`: SUBMITTED 세션 중 클리어 기준을 충족한 기록이 있음(한 번 클리어되면 유지)
  * 클리어 기준(MVP 기본): SUBMITTED 세션의 **정답률 ≥ 80%** (문항 최소 5개 기준 권장)
  * (권장) progress 응답에 `activeSessionId`(진행 중 DRAFT 세션) 포함 → “이어하기”에 사용
  * `GET /student/progress?graphVersionId=...` API 제공
* **DoD**

  * progress 응답만으로 노드 상태를 FE에서 바로 렌더 가능
  * 첫 로그인(기록 없음)에서도 start node만 AVAILABLE로 계산됨
  * 상태 계산/잠금 해제 규칙 테스트(최소): start node, CLEARED→AVAILABLE, DRAFT→IN_PROGRESS 케이스가 자동화됨
* **의존성**: ST-007, ST-004

---

## ST-009 잠금/해제 로직 구현(Simple Unlock) + 시작 노드 정의

* **우선순위**: P0
* **목적**: “도전 가능한 노드만 활성” 규칙을 시스템적으로 고정
* **작업 내용**

  * start node 규칙 구현
    * (기본) incoming prereq가 없는 노드
    * (옵션) Author가 `isStart=true`로 지정 가능(데이터 필드 설계)
  * Simple Unlock: start node 또는 “CLEARED ->(prereq)-> target”이면 AVAILABLE
  * LOCKED 클릭 시 사유 메시지 제공을 위한 “필요 선수 노드 목록” 계산
* **DoD**

  * LOCKED/AVAILABLE 판정이 그래프/진행 상태와 일관됨
  * 최소 1개의 학습 루프에서 “다음 노드만 활성”이 재현됨
* **의존성**: ST-004, ST-008

---

## ST-010 Student Graph UI: 상태 색상/아이콘/흐림 + legend

* **우선순위**: P0
* **목적**: 학생이 “지금 어디까지 했고 무엇을 할 수 있는지” 한눈에 보게 함
* **작업 내용**

  * 상태별 스타일 적용
    * CLEARED / AVAILABLE / IN_PROGRESS / LOCKED
  * LOCKED는 흐림 처리 + 도전 버튼 비활성
  * contains/prereq 등 엣지 타입이 있다면 스타일 구분(필요 최소)
  * legend(색/상태 설명) 추가
* **DoD**

  * 그래프에서 상태가 명확히 구분됨
  * LOCKED 노드가 “회색/흐림 + 비활성”으로 보임
* **의존성**: ST-008, ST-009, ST-001

---

## ST-011 Student 노드 상세 패널 + “도전하기” 버튼 동작

* **우선순위**: P0
* **목적**: 학생이 노드를 클릭하고 바로 학습을 시작할 수 있게 함
* **작업 내용**

  * 상세 패널에 노드 정보 + 상태 + 정답률 요약 표시
  * AVAILABLE/IN_PROGRESS일 때 “도전하기/이어하기” 버튼 활성
  * LOCKED 클릭 시 잠금 사유(필요 선수 노드) 표시
* **DoD**

  * AVAILABLE/IN_PROGRESS 노드에서 “도전하기/이어하기” 클릭 시
    * `POST /student/node/:nodeId/session/start` 호출로 sessionId 확보
    * `/student/session/:sessionId/learn`으로 이동
  * LOCKED에서는 안내만 노출되고 학습 시작 불가
* **의존성**: ST-010, ST-012

---

## ST-012 풀이 세션(DRAFT) 생성/재개 규칙 확정 + FE 상태 관리

* **우선순위**: P0
* **목적**: “노드 클릭 → DRAFT 세션 시작/이어하기 → 제출 후 결과” 흐름을 안정화
* **작업 내용**

  * 세션 시작/재개
    * nodeId로 `session/start` 호출 → DRAFT 세션을 생성하거나 기존 DRAFT 세션을 반환
  * 문제 로드
    * `GET /student/node/:nodeId/problems`로 문제 목록 로드(정답 제외)
  * 답안 로드/복원
    * 기존 DRAFT 세션이 있으면 저장된 responses를 로드해 입력값을 프리필
  * 제출 후 결과 이동
    * `POST /student/session/:sessionId/submit` 성공 시 `/student/session/:sessionId/eval`로 이동
* **DoD**

  * DRAFT 세션에서 입력 중 새로고침해도 답안이 복원됨
  * 제출 후 결과 페이지로 이동하고, 새로고침해도 결과가 유지됨(`GET /student/session/:sessionId/result`)
* **의존성**: ST-005, ST-007, ST-001

---

## ST-013 문제풀이 화면(UI): 다문항 주관식 입력 + 임시저장 + 일괄 제출

* **우선순위**: P0
* **목적**: 학생 학습의 핵심 인터랙션 제공
* **작업 내용**

  * 한 화면 폼 방식(권장)으로 문제 리스트 렌더
    * 문제 문구 + 주관식 입력 칸
    * 상단에 `현재 입력 완료: x / 전체: n` 표시
  * 수식/표현 렌더링(P0)
    * `promptFormat="latex"`인 문제는 KaTeX(권장)로 렌더링
    * 최소 inline 수식 지원(가능하면 block도 지원)
  * 자동 저장(권장)
    * 입력 변경 시 디바운스하여 `PATCH /student/session/:sessionId/response` 호출
    * “임시저장됨/저장 중/저장 실패” 상태 표시
  * 제출
    * [제출] 버튼(기본: 모든 문제 입력 완료 시 활성)
    * 제출 확인 모달(제출 후 채점/기록 안내)
    * 확인 시 `POST /student/session/:sessionId/submit` 호출 → 결과 화면으로 이동
  * 풀이 중에는 정오/정답을 보여주지 않는다(평가 페이지에서만 공개)
* **DoD**

  * 제출 전에는 정오/정답이 표시되지 않는다
  * 제출 후 평가 페이지에서 정오/정답이 표시된다
  * 제출 결과가 `attempt_sessions`/`responses`로 저장됨
  * `promptFormat="latex"` 문제의 기본 수식(분수/곱셈/괄호)이 깨지지 않고 표시됨
* **의존성**: ST-012, ST-007

---

## ST-014 평가 결과 API: `GET /student/session/:sessionId/result` (태그별 분석 포함)

* **우선순위**: P0
* **목적**: 평가(진단) 페이지가 필요한 데이터를 1번에 로드
* **작업 내용**

  * 제출된 세션(SUBMITTED) 기준 결과 응답 제공
    * 요약(정답률/맞은 개수/문항 수/클리어 여부)
    * 문제별 결과(문구/내 답/정답 스냅샷/정오)
    * tag(subskillTag)별 정답률 집계
  * next 후보 노드(1~3개) 반환(가능하면)
* **DoD**

  * result API 하나로 평가 페이지가 렌더 가능
  * DRAFT 세션에 대한 result 조회는 실패(예: 409/400)해야 한다(제출 전 결과 노출 방지)
* **의존성**: ST-007, ST-008, ST-009

---

## ST-015 평가(진단) 페이지 UI: 요약 + 문제별 리스트 + 태그별 분석 + CTA

* **우선순위**: P0
* **목적**: “어디까지 이해했고 어디서 막혔는지”를 학생이 확인
* **작업 내용**

  * 요약 카드(정답률/클리어 여부)
  * 문제별 결과 리스트(오답 강조)
  * tag별 정답률(막힌 부분) 표시
  * CTA: “다음 노드 도전하기”, “이 노드 다시 풀기”
* **DoD**

  * 제출 완료 후 자동으로 평가 페이지로 이동
  * 태그별 분석이 실제 데이터로 렌더됨
* **의존성**: ST-014, ST-013

---

# M5 — Student Mode: Drill-down 흐름 + 다음 노드 이동(그래프 기반 진행)

> 목표: “클리어 → 다음 노드 자동 강조/이동”을 통해 드릴다운 학습 경험을 완성한다.

## ST-016 다음 노드 하이라이트(그래프) + “다음 단계로 이동” 버튼

* **우선순위**: P0
* **목적**: 학습 흐름이 끊기지 않게 다음 행동을 명확히 제시
* **작업 내용**

  * 평가 페이지에서 next 후보 노드(1~3개)를 보여주고 그래프에서 강조
  * “다음 노드 도전하기” 클릭 시 해당 노드 상세/학습으로 이동
* **DoD**

  * 평가 페이지 → 다음 노드로 자연스럽게 이동
* **의존성**: ST-015, ST-010

---

## ST-017 집중 지도(서브그래프) 기본 제공 + 전체 지도 토글

* **우선순위**: P1
* **목적**: 학생이 “길을 잃지 않게” 다음 스텝을 선명하게 보여줌
* **작업 내용**

  * 기본: 선택 노드 주변(선수/다음/관련)만 렌더링
  * 토글: “전체 지도 보기” 제공
* **DoD**

  * 덧셈 노드 선택 시 주변 연결만 보이는 집중 화면으로 학습 시작 가능
* **의존성**: ST-010

---

## ST-018 잠김 노드 클릭 시 “왜 잠겼는지” 상세 안내(선수 노드 목록)

* **우선순위**: P1
* **목적**: 잠김 상태가 “막힌 이유”를 학습 안내로 전환
* **작업 내용**

  * LOCKED 노드의 incoming prereq 소스 노드 목록 표시
  * 소스 노드들의 상태(CLEARED/IN_PROGRESS 등) 같이 표시
* **DoD**

  * 잠김 노드 클릭 시 “먼저 [A], [B]를 클리어해야 합니다” 안내가 표시됨
* **의존성**: ST-011, ST-009

---

## ST-019 Strict Prereq 옵션(설정값) 추가

* **우선순위**: P2
* **목적**: 다중 선수조건 노드에서 unlock 오류를 방지할 수 있게 함
* **작업 내용**

  * 설정값으로 Simple/Strict 전환 가능하게 설계
  * Strict: 대상 노드의 모든 prereq 소스 노드가 CLEARED일 때만 AVAILABLE
* **DoD**

  * 설정 변경에 따라 AVAILABLE 판정이 달라지고 UI가 즉시 반영됨
* **의존성**: ST-009

---

## ST-020 그래프 버전 변경 정책 구현(graphVersionId 기준 진행 분리)

* **우선순위**: P1
* **목적**: Publish 업데이트 시 진행 기록 꼬임 방지
* **작업 내용**

  * `graphVersionId`로 attempt_sessions/responses/progress를 분리 저장
  * 새 버전 publish 시 학생은 새 진행으로 시작(MVP 정책)
  * UI에 “새 버전이 배포되어 새 진행으로 시작합니다” 안내(선택)
* **DoD**

  * 버전이 바뀌어도 기존 기록이 섞이지 않음
* **의존성**: ST-004, ST-007

---

## ST-021 (선택) `node_progress` 캐시/집계 테이블 도입

* **우선순위**: P2
* **목적**: 데이터가 커져도 progress 계산이 느려지지 않게 함
* **작업 내용**

  * 제출/채점 완료 시(node session submit) node_progress를 업데이트(또는 배치 계산)
  * progress API가 캐시를 우선 사용
* **DoD**

  * progress 조회가 responses/세션 전수 스캔 없이도 동작 가능
* **의존성**: ST-008

---

## ST-022 Student Mode E2E 시나리오 스모크 테스트

* **우선순위**: P1
* **목적**: 회귀 방지(로그인→문제풀이→평가→다음노드)
* **작업 내용**

  * 최소 2개 시나리오 자동화
    * 첫 로그인: start node만 AVAILABLE
    * 제출/채점 완료: CLEARED 전환 + next 노드 AVAILABLE
* **DoD**

  * CI(또는 로컬)에서 스모크 테스트가 재현 가능
* **의존성**: ST-015, ST-016

---

## ST-023 Student 상단 요약(진행률/전체 정답률/클리어 수)

* **우선순위**: P1
* **목적**: 학생이 전체 진행 상황을 한눈에 파악
* **작업 내용**

  * Student 그래프 화면 상단에 요약 카드/바 제공
    * 전체 정답률(최근 제출(SUBMITTED 세션) 기준)
    * CLEARED 노드 수 / 전체 노드 수
    * (선택) 현재 graphVersion 표시
* **DoD**

  * 문제 풀이/클리어에 따라 요약 수치가 즉시 갱신됨
* **의존성**: ST-008, ST-010

---

## ST-024 “IN_PROGRESS” 정의/표시 강화(재시도 UX 포함)

* **우선순위**: P1
* **목적**: 미클리어 상태를 “실패”가 아니라 “진행 중”으로 안내
* **작업 내용**

  * IN_PROGRESS 판정 기준을 문서/코드로 고정
    * 예: DRAFT 세션이 존재하거나, SUBMITTED지만 CLEARED가 아님
  * 그래프에서 IN_PROGRESS 배지/테두리 표시 강화
  * 상세 패널에서 “재도전” CTA 제공
* **DoD**

  * 한 번이라도 시도한 노드는 IN_PROGRESS로 전환되고, 재도전 동선이 명확함
* **의존성**: ST-008, ST-011, ST-012

---

## ST-025 학습 세트 이어하기(Resume) 정책 확정 + 구현

* **우선순위**: P2
* **목적**: 중간 이탈 시에도 학습 경험이 끊기지 않게 함
* **작업 내용**

  * 노드별 “진행 중(DRAFT) 세션”을 이어서 풀기
    * 저장된 responses를 불러와 입력값을 복원
  * 제출 완료(SUBMITTED) 이후 재도전 정책 명시
    * (기본) 새 DRAFT 세션 생성
    * (옵션) 동일 세션 재도전(권장하지 않음: 결과 변경/감사 로그 꼬임)
* **DoD**

  * 문제 2개 풀고 나가도 다시 들어오면 이어서 풀 수 있음(또는 명확히 새로 시작)
* **의존성**: ST-012, ST-007

---

## ST-026 다음 노드 추천 규칙 구현(단순 규칙 기반)

* **우선순위**: P2
* **목적**: “다음 단계로 이동”이 항상 하나의 추천으로 동작하게 함
* **작업 내용**

  * 기본 규칙
    1) prereq target 1개면 그 노드
    2) 여러 개면 AVAILABLE 우선, 그 다음 order/가중치(있으면) 우선
  * 평가 페이지/그래프에서 추천 1순위를 별도 강조
* **DoD**

  * 여러 후보가 있어도 “추천 1순위”가 일관된 규칙으로 선택됨
* **의존성**: ST-016, ST-009

---

## ST-027 제출 전 검토 UX(미입력 표시/체크리스트)

* **우선순위**: P2
* **목적**: 일괄 채점(진단) 방식에서 “제출 전 불안/누락”을 줄이고 제출 품질을 높임
* **작업 내용**

  * 미입력 문제 표시
    * 미입력 문제에 배지/점 표시(예: 빨간 점)
    * 상단에 “미입력 문제: k개” 요약 + 클릭 시 해당 문항으로 스크롤
  * 제출 전 체크리스트(권장)
    * 제출 모달에서 “미입력 문제 없음” 또는 “미입력 문제 k개(빈칸 오답 처리)”를 명확히 안내
* **DoD**

  * 학생이 제출 전에 누락 문항을 쉽게 발견/이동할 수 있음
* **의존성**: ST-013

---

## ST-028 학생용 에러/안내 UX 표준화(토스트/빈 상태/권한 오류)

* **우선순위**: P1
* **목적**: 실패 상황에서 “왜 안 되는지”를 학생에게 명확히 보여줌
* **작업 내용**

  * 로그인 만료/권한 오류 시 재로그인 안내
  * 그래프/문제/평가 로딩 실패 시 빈 상태 + 재시도 버튼
  * LOCKED 안내 문구 표준화(“선행 노드를 먼저 완료하세요” + 필요한 노드 리스트)
* **DoD**

  * 네트워크 오류/404/권한 오류가 모두 UX로 처리됨(콘솔 에러로 끝나지 않음)
* **의존성**: ST-001, ST-010, ST-011

---

## ST-029 API 스키마 문서화 + 에러 코드 카탈로그

* **우선순위**: P2
* **목적**: FE/BE 협업 시 계약을 고정하고 변경 비용을 줄임
* **작업 내용**

  * Student API 응답 스키마(요약/예시) 문서화
  * 에러 코드 목록 정리(로그인 실패, 그래프 없음, 노드 없음, 문제 없음 등)
* **DoD**

  * 개발자가 문서만 보고 FE/BE를 각각 구현/디버깅 가능
* **의존성**: ST-003 ~ ST-016

---

## ST-030 Student Mode 최종 시연 스크립트/데모 데이터 고정

* **우선순위**: P0
* **목적**: 인수/시연이 매번 동일하게 재현되게 함
* **작업 내용**

  * 덧셈(drill-down) 데모용 그래프 + 문제은행 + 태그가 포함된 seed 데이터 고정
    * MVP 코스 노드 수: 8~15개(권장)
    * 노드별 문제 수: 최소 5문항(권장 7~10)
    * 태그(subskillTag) 포함 + `promptFormat="latex"` 샘플 포함
  * 시연 시나리오 A/B를 그대로 재현 가능한 “데모 계정/데모 플로우” 제공
* **DoD**

  * 로컬에서 “로그인 → AVAILABLE 노드 → 문제풀이 → 평가 → 다음노드”가 5분 내 재현 가능
* **의존성**: ST-022, ST-015, ST-016

---

# Appendix — 수학 문제풀이 앱 MVP 추가 작업 지시서 (Student Mode 중심)

> 아래는 “수학 문제를 푸는 앱” 관점에서 Student Mode MVP가 실제로 작동하기 위해 필요한 추가 작업을 정리한 지시서다.  
> 본 문서의 ST-001 ~ ST-030 백로그가 이 지시서 범위를 커버해야 한다.

## 0) MVP 목표(한 문장)

학생이 로그인하면 **그래프에서 현재 학습 상태(클리어/도전가능/잠김)를 확인**하고,
도전 가능한 노드에서 **주관식 문제를 모두 푼 뒤 제출(일괄 채점)**하여,
결과(정오/정답/진단)를 보고 **다음 연결 노드로 이동**하는 루프를 완주할 수 있어야 한다.

---

## 1) MVP에서 “반드시” 필요한 추가 작업 영역(큰 분류)

1. **문제 콘텐츠 파이프라인**(문제 데이터/정답/채점 규칙/태그)
2. **문제 화면 UX**(수식 렌더링, 입력 UX, 제출/검토, 임시저장/이어풀기)
3. **일괄 채점/평가 페이지**(정오표, 진단, 다음 노드 추천/해제)
4. **진행 상태 계산**(클리어/도전가능/잠김 규칙의 정확한 구현)
5. **데이터 저장/버전 정책**(graphVersion, session, responses, 결과)
6. **테스트/검수 체크리스트**(채점/잠금/버전 변경 시나리오)

---

## 2) 작업 지시 상세(개발팀용)

### EPIC S-1: 문제 콘텐츠 데이터 모델 확정 + 관리 방식

#### S-1-1 문제 데이터 스키마 확정(P0)
- 작업 내용: `Problem` 필드 확정(`problemId`, `nodeId`, `order`, `prompt`, `promptFormat`, `grading`, `answer`, `tags[]`)
- 산출물: problems 스키마 문서 + 샘플 20문항
- DoD: 프론트에서 문제 렌더/입력/임시저장/제출까지 가능

#### S-1-2 진단용 태그 체계(subskillTag) 도입(P0)
- 작업 내용: 각 문제에 최소 1개 이상 태그 부여(예: `place_value`, `carry_tens`, `carry_hundreds`, `word_problem`, `estimate`)
- 산출물: 태그 목록 문서 + problems 데이터 반영
- DoD: 평가 페이지에서 “태그별 정답률” 계산 가능

#### S-1-3 문제 은행 최소 분량 정의(P0)
- 작업 내용: MVP(초3 덧셈 드릴다운) 대상 노드 수 8~15개 확정 + 노드별 최소 5문항(권장 7~10)
- 산출물: “MVP 코스 노드 목록” + 노드별 문제 개수 표
- DoD: 최소 1개 코스(덧셈) 완주 가능(노드마다 문제 세트 존재)

---

### EPIC S-2: 문제 화면 UX(일괄 제출 방식)

#### S-2-1 수식/표현 렌더링 지원(P0)
- 작업 내용: `promptFormat="latex"`면 KaTeX(권장)로 렌더(최소 inline, 가능하면 block)
- 산출물: latex 샘플 문제
- DoD: 분수/곱셈/괄호 같은 기본 수식이 깨지지 않고 표시됨

#### S-2-2 “문제 폼” 방식 UI 구현(P0)
- 작업 내용: 고정 순서 문제 리스트 + 입력칸 + `입력 완료 x/n` 표시
- 산출물: NodeSolvePage(문제 폼 UI)
- DoD: 10문항 이상에서도 입력/스크롤 가능 + 새로고침/이탈 후 복귀 시 입력 복원

#### S-2-3 임시저장/이어풀기(DRAFT 세션) 구현(P0)
- 작업 내용: DRAFT 세션 생성 + 입력 디바운스 저장(PATCH) + 나가기/복귀 시 이어풀기
- DoD: 제출 전 정답/정오가 노출되지 않음

#### S-2-4 제출 전 검토 UX(P1)
- 작업 내용: 제출 시 미입력 문항 목록 안내 + 돌아가기/그래도 제출 선택
- DoD: 빈칸 제출로 인한 불필요한 오답을 줄임

---

### EPIC S-3: 일괄 채점 + 평가(진단) 페이지

#### S-3-1 제출(Submit) API 및 서버 채점(P0)
- 작업 내용: `POST /student/session/:id/submit`에서 normalize+grading 수행 + 결과 생성 + 세션 SUBMITTED 전환
- DoD: 제출 시 결과가 생성되고 새로고침해도 `GET result`로 조회 가능

#### S-3-2 평가 페이지 UI(P0)
- 작업 내용: 요약(정답률/클리어/CTA) + 문제별 채점표(문구/내 답/정답/정오)
- DoD: 결과 화면이 항상 동일 데이터로 재현됨

#### S-3-3 “막힌 지점” 진단(태그별 결과)(P0)
- 작업 내용: subskillTag별 정답률 계산 + 강점/약점 섹션
- DoD: 예) `carry_hundreds 33%` 같은 결과가 보임

#### S-3-4 다음 노드 추천/강조(P0)
- 작업 내용: 통과 시 prereq target 중 AVAILABLE 후보 제공 + “다음으로 이동”
- DoD: 평가에서 다음 노드로 자연스럽게 이동 가능

---

### EPIC S-4: 진행 상태 계산(클리어/도전가능/잠김)

#### S-4-1 상태 계산 엔진(P0)
- 작업 내용: CLEARED/IN_PROGRESS/AVAILABLE/LOCKED 계산(세션 기반) + start node 정책(prereq incoming 없음 또는 author 지정)
- DoD: 로그인 시 상태가 한 번에 계산되어 그래프에 반영됨

#### S-4-2 잠김 노드 UX(P0)
- 작업 내용: LOCKED 흐림 + 클릭 시 “선행 노드 목록” 안내
- DoD: 학생이 ‘왜 안 되는지’ 이해 가능

#### S-4-3 클리어 기준 설정 가능(운영 옵션)(P1)
- 작업 내용: 기본값(정답률 ≥ 80%, 문항 최소 5) + 설정으로 변경 가능
- DoD: 기준 변경 시 클리어 판정에 반영됨

---

### EPIC S-5: 로그인/계정/데이터 저장(서비스 운영 최소)

#### S-5-1 로그인/세션 유지(P0)
- DoD: 계정이 다르면 진행상태가 달라야 함

#### S-5-2 graphVersion 정책 적용(P0)
- DoD: publish로 그래프가 바뀌어도 이전 기록이 섞이지 않음(정책대로)

#### S-5-3 “내 진행 요약” 위젯(P1)
- DoD: 그래프 상단에서 현재 상태를 한눈에 이해

---

### EPIC S-6: 품질 보장(QA/테스트/검수)

#### S-6-1 채점 유닛 테스트(P0)
- DoD: normalize/numeric_equal 대표 케이스 20개 이상 자동 테스트 통과

#### S-6-2 상태 계산 테스트(P0)
- DoD: CLEARED→AVAILABLE/LOCKED 메시지 대상 노드 목록/IN_PROGRESS 판정이 케이스별로 검증됨

#### S-6-3 E2E 시나리오 테스트(P1)
- DoD: 로그인 → 입력 → 제출 → 평가 → 다음 노드 해제 흐름이 자동 테스트로 통과

---

## 3) MVP에 필요한 “콘텐츠 제작 지시”(비개발/출제자 작업)

### C-1 MVP 코스(덧셈) 노드 구성
- 예시: 자리값 이해 → 받아올림 없는 덧셈 → 받아올림(십) → 받아올림(백) → 세 수 덧셈 → 문장제(덧셈) …
- 각 노드에 prereq 연결 설계

### C-2 각 노드별 문제 5~10개 제작 + 태그 부여
- 정답이 단일한 수가 나오게 설계(주관식 채점 안정성)
- 각 문제에 태그 1개 이상 부여(subskillTag)

### C-3 정답 형식 규칙 명시
- 정수만/소수 허용/단위 입력 필요 여부 등을 문제마다 명확히

---

## 4) 최종 인수 기준(수학 앱 관점의 MVP 체크리스트)

1. 로그인 → 그래프 로드 → 이전 클리어 노드가 클리어 색으로 보임
2. 클리어와 연결된 노드는 도전 가능 버튼 활성
3. 연결되지 않은 노드는 흐림/비활성 + 이유 안내
4. 노드 도전 → 문제를 모두 입력(풀이 중 정오 표시 없음)
5. 제출 → 일괄 채점 → 평가 페이지에서 정오/정답/요약/진단 확인
6. 기준 충족 시 해당 노드 CLEARED로 변경
7. 다음 연결 노드가 AVAILABLE로 해제되고 “도전하기”가 활성
8. 새로고침/재로그인해도 진행이 유지됨
9. prompt에 수식이 있어도 깨지지 않음(KaTeX 동작)

---

## 5) PM이 다음으로 해야 할 일(티켓화 지시)

- 본 지시서를 기준으로 Student Mode 백로그(ST-001~ST-030)를 우선순위(P0/P1)대로 실행 순서에 맞게 배치한다.
