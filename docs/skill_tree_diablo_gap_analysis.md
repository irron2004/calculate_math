# Diablo-Style Skill Tree Gap Analysis

## 문제 요약
현재 앱에 구현된 스킬트리 화면은 개별 개념 카드를 나열하는 수준에 머물러 있으며, 디아블로 시리즈에서 볼 수 있는 **노드-엣지 기반 그래프** 구조가 제공되지 않습니다. 원인을 조사한 결과, 아래 세 가지 축에서 동시에 누락이 발생한 것으로 확인되었습니다.

1. **데이터 스키마 부족** – `data/skills.json`에 스킬 간 선행/후행 관계를 표현할 필드(`prerequisites`, `tier` 등)가 정의되지 않았습니다. 모든 스킬이 서로 독립된 항목으로 취급되기 때문에 그래프를 구성할 수 있는 근거 데이터가 존재하지 않습니다.
2. **백엔드 트리 조립 미구현** – `/api/v1/skills/tree` 엔드포인트가 관계 데이터를 읽어 트리(또는 DAG) 구조를 조립하거나, 스킬 해금 상태(`unlocked`)를 계산하는 로직을 제공하지 않습니다. 결국 클라이언트는 단순 리스트 응답만 받게 되어 선행 조건을 추론할 수 없습니다.
3. **프런트엔드 그래프 렌더링 부재** – React 레이어는 그래프 시각화 라이브러리(예: React Flow, D3)를 사용하지 않고 단순 카드 리스트 UI만 구현했습니다. 설령 관계 데이터가 준비되더라도 현재 구조로는 선 연결선과 계층 배치를 표현할 수 없습니다.

## 영향
- 학습 단계 간의 종속성을 시각적으로 이해할 수 없어, 학습자의 진행 동기와 다음 목표 제시가 약화됩니다.
- 잠금/해제 규칙을 UI로 전달할 수 없어, 난이도 설계 및 게이미피케이션 요소(보스전, 티어 해제 등)를 노출할 수 없습니다.
- 백엔드와 프런트엔드가 동일한 트리 스키마를 공유하지 않아, 향후 데이터 파이프라인(DAG, XP 시스템) 통합이 지연됩니다.

## 개선 권장 사항

### 1. 데이터 스키마 보강
- 모든 스킬에 고유 `id`, `tier`, `prerequisites` 배열을 추가합니다.
- `skills.schema.json`을 확장하여 위 필드를 필수 값으로 정의하고, 순환 참조를 금지하는 검증 스크립트를 추가합니다.
- 선행 스킬이 없는 루트 노드는 `prerequisites: []`로 명시하여 클라이언트에서 초기 해금 상태를 판단할 수 있도록 합니다.

### 2. 백엔드 트리 엔드포인트 개선
- `/api/v1/skills/tree`가 스킬 데이터를 로드한 뒤, 티어별로 정렬하고 각 스킬의 `prerequisites`를 사용하여 children 또는 edges 목록을 구성하도록 리팩터링합니다.
- 사용자 진행도(획득한 스킬 ID 목록)를 입력 받아 `unlocked`/`unlockable` 상태를 계산한 뒤 응답에 포함합니다.
- 캐시 키를 `version:user_id`로 설정하여 사용자별 진행 상태 변화를 안정적으로 반영합니다.

### 3. 프런트엔드 그래프 UI 도입
- React Flow와 같은 그래프 렌더링 라이브러리를 도입해 노드/엣지를 시각화합니다.
- 티어 값을 y좌표, 같은 티어 내 인덱스를 x좌표로 사용하여 기본 레이아웃을 구성합니다. 필요 시 자동 레이아웃 알고리즘을 추가로 검토합니다.
- `unlocked` 상태에 따라 노드 색상, 테두리, 잠금 아이콘 등을 조건부로 표시하고, 선행 조건을 툴팁/보조 텍스트로 안내합니다.
- 팬/줌, 키보드 내비게이션, 스크린리더 지원(ARIA 레이블) 등 접근성 요구사항을 반영합니다.

## 다음 단계
1. `skills.json`에 관계 필드를 추가하고, 샘플 데이터 세트를 구성하여 프런트엔드가 참조할 수 있도록 합니다.
2. 백엔드 단에서 신규 스키마를 사용하는 데이터 클래스를 작성하고, FastAPI 라우터/서비스에 트리 변환 로직을 구현합니다.
3. 프런트엔드에서 React Flow 기반 프로토타입을 제작하고, 기존 카드 UI와 비교하는 A/B 실험 계획(`docs/experiments/*`)에 통합합니다.
4. 문서화: 본 분석 문서를 `docs/README_dag_pipeline.md`와 연동하고, 관련 태스크를 `tasks.md`에 업데이트합니다.

위 단계가 완료되면, 디아블로 스타일의 계층형 스킬트리를 구현하기 위한 데이터·백엔드·프런트엔드 토대가 갖춰집니다.

## TODO (UI polish follow-ups)

- 그래프 노드 카드 자체에도 주요 요구 조건·보상 요약 배지를 노출하거나 툴팁을 추가해서 상세 오버레이 없이도 상태를 파악할 수 있도록 하기.
- 화살표 키 / Home / End 등 키보드 내비게이션으로 노드 간 이동을 지원하고, 포커스 이동 시 보조 안내를 제공해 접근성 강화.
- `/skills/progress` 성공 후 새로 해금된 노드를 시각적으로 강조하거나 토스트로 알리는 즉시 피드백 연출 추가.
- `skill-tree:progress-updated` 이벤트가 연속 발생할 때 fetch 를 디바운스 / 중복 요청 취소하여 네트워크 사용 최적화.
