# 제품 기획서(PRD) — 디아블로식 스킬 트리 기반 연산 학습 서비스 (v1.0.2)

아래 문서는 지금까지 합의한 철학(“초2 시작 → S1/S2/S3 전이”, 디아블로식 스킬 트리, **CourseStep×AtomicSkill** 이중 레이어 DAG, LRC 게이트, 자동 변형 문제 엔진)을 기반으로 정리한 **제품 기획서(PRD)**입니다. 그대로 팀과 공유해도 됩니다.

> 변경 요약(v1.0.1)
> - Single Source of Truth 확정: 본 문서를 메인 PRD로 승격.
> - Phase 1 타겟/범위/일정 현실화: 초2~초4, 코스 3개×S1/S2, 템플릿 30개, 10–12주.
> - Unlock 규칙: Phase 1=ALL, 제한적 ANY는 교사 모드 + Phase 2.
> - 보스전: 합격선 80/100, 쿨다운 없음. 실패 시 리미디얼 추천 UX.
> - 접근성: 리스트 뷰(대체 UI) 추가.
> - 설명 채점: Phase 1 선택, S3에서만 필수(키워드 매칭). 임베딩/음성은 후속 단계.
> - 문제 생성 최소 품질 게이트: 중복 방지/범위·자릿수 검증/파라미터 제약. IRT는 Phase 2.
> - 수익화: 무료=S1 무제한+S2 일부, 유료=전체+리포트+교사 콘솔. S2 2번째 완료 시 전환 모달.
> - 결정 로그: docs/pm/DECISIONS.md 참조.

> 변경 요약(v1.0.2)
> - 섹션4에 Phase 구분 명시(전체 비전 12코스 vs Phase‑1 3코스).
> - 부록B를 72시간 리스트에서 10–12주 실행 체크리스트로 교체.
> - 부록D/E 프레임 추가(커리큘럼/AS 목록 요약, API 요약/예시).
> - 마무리 문구를 10–12주 로드맵과 일치하도록 수정.

---

# 0. 한 줄 정의(엘리베이터 피치)

**“같은 구조를 다른 맥락에서 반복 노출해 전이를 가속하는 수학 학습 OS.”**
디아블로식 스킬 트리로 **러닝 경로를 시각화**하고, **원자 스킬(곱셈, 차이 읽기, 표→식 등)**을 **여러 코스·스텝에 공유**하여 **학년을 뛰어넘는 전이**를 만든다.

---

# 1. 왜 지금? (문제 정의 & 차별점)

* **현실의 문제**

  * 기존 앱은 ‘학년/단원’ 선형 진도 중심 → **전이(transfer)와 구조 감각**이 약함.
  * “문제 은행”은 많지만 **문제의 내부 구조 태깅**과 **스킬 공유/재활용**이 부족.
  * 학부모에게 **진짜 성취(상위 개념으로의 도약)**가 잘 보이지 않음.

* **우리의 해법(차별점)**

  1. **이중 레이어 DAG**: `CourseStep(CS)`와 `AtomicSkill(AS)`를 분리. 같은 스킬이 **여러 코스·스텝에 연결** → 한 번 익힌 스킬이 다른 곳의 **잠금 해제**에 즉시 반영.
  2. **S1→S2→S3 전이 디자인**: S1(초2 표현/조작) → S2(표↔식↔그래프 브리지) → S3(최상위 구조).
  3. **LRC(Leap Ready Criteria)**: 정확도·속도·설명 루브릭으로 **도약 준비 상태**를 판정.
  4. **자동 변형(Variants)**: 같은 구조의 수치/맥락을 바꾸어 **문맥 의존 학습 방지**.
  5. **렌즈(차분/누적/비율/스케일/변환/무작위)** 배지: **어떤 시각으로** 문제를 볼지 메타인지 유도.

---

# 2. 대상 사용자 & JTBD

* **학생(초2~초4 | Phase 1)**: “학년 상관 없이 **상위 개념을 이해**하고 싶다.” (중등은 Phase 2로 이관, 기본은 흐림 노출)
* **학부모**: “아이의 **도약(Unlock)**과 **설명 능력**을 눈으로 확인하고 싶다.”
* **교습소/교사**: “**개념-스킬-문항**이 연결된 교재·수업 악보가 필요하다.”

**Jobs-to-be-done**

* “덧셈만 잘해도 **등차수열**이 보이게 해줘.”
* “스킬이 어느 코스에 먹히는지 **시각적으로** 보여줘.”
* “아이 설명을 루브릭으로 **정량화**해줘.”

---

# 3. 제품 비전 & 핵심 원칙

* **비전**: “학년”이 아니라 **구조**로 배우는 수학.
* **원칙**

  * 전이는 설계한다: **같은 구조 다른 맥락(동형 3형제)** 제공
  * 설명 우선: **Explain-first** 해설 + 루브릭
  * 작게 쪼개고 크게 연결: **AtomicSkill**을 1급 시민으로 관리
  * 투명한 경로: **스킬 트리 시각화**로 다음 단계가 보이게

---

# 4. 커리큘럼 설계(이중 레이어 DAG)

## 전체 비전(Phase 1~3)
- **CourseStep(CS)**: 12개 코스 × S1/S2/S3 = 36 노드
- **AtomicSkill(AS)**: 약 60~80개(현재 64개 초안). 곱셈/나눗셈, 표→식, 차분, 기울기, 누적합 등.

## Phase‑1 범위(초2~초4)
- **CourseStep**: 3개 코스 × S1/S2 = 6 노드
  - C01: 덧셈(S1/S2)
  - C03: 곱셈(S1/S2)
  - C05: 분수(S1/S2)
- **AtomicSkill(필수 20)**: AS.ADD.BASIC, AS.ADD.CARRY, AS.MUL.FACTS, AS.MUL.POW10, AS.MUL.TWOxONE, AS.FRAC.CONCEPT, AS.FRAC.EQUIV, AS.FRAC.ADD, AS.FRAC.SUB, AS.FRAC.COMPARE, AS.TABLE.READ, AS.TABLE.DIFF, AS.LINE.SLOPE_INTUIT, AS.NUM.SCALE10, AS.TIME.UNIT, AS.MEASURE.LENGTH_UNIT, AS.SHAPE.RECT_AREA, AS.PATTERN.NEXT, AS.EXPLAIN.KEYWORDS, AS.A11Y.LIST_NAV (세부는 부록D)

**엣지 타입**

* `requires (AS→CS)`: 스텝 시작 최소 레벨(예: `AS.MUL.FACTS:2`)
* `teaches (CS→AS)`: 스텝 완료 시 올려주는 스킬(+1 등)
* `enables (CS→CS)`: 전이 추천 경로(예: C03-S3 → C07-S1)

> 샘플 데이터: **graph.bipartite.json**(100 노드/182 엣지) — *지금 바로 시각화 가능.* (경로: `data/graph.bipartite.json`)

---

# 5. 마스터리 모델 & LRC

* **AS 레벨**: 0(미시작)–3(숙련).
* **시도 갱신(EWMA)**: 정답·반응시간·설명 루브릭으로 레벨 점수 갱신 → 임계값 통과 시 레벨업.
* **LRC(도약 기준)**

  * S1: 정확 ≥ 0.85
  * S2: 정확 ≥ 0.90 (설명 선택)
  * S3: 정확 ≥ 0.90 & 속도 백분위 ≥ 0.55 & 설명 ≥ 0.60(설명 필수)
* **Unlock**: `모든 requires(AS,min_level)` 충족 시 CS 열림.

---

# 6. 문제 생성 전략(템플릿 → 변형)

* **템플릿 구조**: `params_schema`(범위), `make_stimulus`(표/그림/데이터), `solve()`(정답·근거), `distractors`
* **Variants**: 씨드 기반 결정적 생성(중복 회피), **컨텍스트 로테이션**(생활/표/도형), **표현 전환**(C→P→A)
* **품질 게이트(Phase 1 최소)**: 세션 내 중복 방지(seed/최근 히스토리), 값 범위/자릿수 검증, 파라미터 제약. IRT/Rasch는 Phase 2.
* **설명 우선**: 정답 제출 전 **한줄 설명**을 유도(기울기=공차 등 핵심어 감지)

---

# 7. 핵심 화면(UX 플로우)

1. **홈 = 디아블로식 스킬 트리** (+ 대체 UI: 리스트 뷰)

   * 레이어 토글: *Course/Step* ↔ *Atomic Skill*
   * 노드 상태: Locked/Unlockable/Unlocked/Mastered, 왕관(보스)
   * 툴팁: **필요 스킬/현재 레벨/부족분** & **이 스텝이 올려주는 스킬**

2. **노드 패널(CS 상세)**

   * 스텝 목표, 렌즈 배지, 오개념, LRC 기준, [연습 시작]
   * 연결: `requires` AS 링크(바로 훈련), `enables` 다음 스텝

3. **세션 플레이어**

   * 문제 영역 + 입력 위젯 + [제출]/[스킵]/[♻︎변형]
   * **렌즈 배지**(차분/누적 등), **설명 필드**(선택/필수)
   * 음성→텍스트(선택)

4. **결과 모달**

   * 원형 정답률 + 속도 백분위 + 설명 루브릭
   * **AS 레벨 상승** 목록, **다음 추천**(갭 스코어) → 트리 복귀 시 “새로 해금된 스킬” 애니메이션 및 자동 포커스 적용

### SessionEnd UX (Phase 1)
- 성공(세션 완료):
  - “새로 해금된 스텝/스킬” 토스트(3초) → “다음 추천” 자동 포커스 → [바로 시작]
- 보스전 실패:
  - 부족 AS(현재/필요 레벨) 하이라이트 + 리미디얼 CS 2개 버튼 제공(즉시 재도전 허용)

> 접근성: 48dp 터치, 키보드 내비, 스크린리더 라벨, 대비 4.5:1.

---

# 8. 데이터 & API(요약)

* `/api/v1/skills/tree` : **bipartite 그래프 + 유저 오버레이(레벨/잠금)**
* `/api/v1/session/start|attempt|variant|submit` : 세션/시도/변형/LRC 결과
* `/api/v1/explanation/score` : 설명 루브릭(키워드/구조)
* 이벤트: `tree_node_opened`, `session_started`, `attempt_submitted`, `lrc_gate_passed`, `skill_leveled`

---

# 9. 콘텐츠 파이프라인

* **저작 가이드**: 태그 표준(AS, 렌즈, 오개념), CPA 전환(C→P→A)
* **소싱 정책**: 시중/수능/경시 **직접 복제 금지** → 구조만 추출해 재저작(문장·수치·이미지 전면 교체)
* **리뷰/파일럿**: 교사 3–5인 블라인드 리뷰 → 파일럿(20–40명) → IRT 보정

---

# 10. KPI & 실험

* **핵심 지표**:

  * **세션 시작률**(트리→연습), **Unlock율**(주/월), **AS 레벨 상승률**, **LRC 통과율**, **7/28일 유지**, **설명 루브릭 평균**, **전이 모의고사 점수**
* **A/B**: 트리 vs 리스트, 설명 필수 vs 선택, 렌즈 배지 유무, 변형 자동 제안 유무

---

# 11. 보안/정책(요약)

* **아동 개인정보 보호**: 최소 수집, 보호자 동의, 음성 원본 저장 Off(기본), 90일 후 비식별/파기
* **콘텐츠 권리**: 내부 라이선스 테이블 유지(출처/권리/범위/증빙)

---

# 12. 로드맵 (0→1, 10–12주)

* **W1–2**: 코스 3개(덧셈/곱셈/분수) × S1/S2 스펙 고정, UI 트리 1차, 세션 플레이어 v1
* **W3–6**: LRC(정확도만), 변형 엔진(최소 게이트), 파일럿 A(콘텐츠: C01~C03, 템플릿 30개)
* **W7–10**: 접근성 리스트 뷰, 전환 모달, DAG 편집 워크플로우, 파일럿 B + 가격 실험
* **W11–12**: 베타 런칭, 사례 리포트, 채널 확장

---

# 13. 리스크 & 대응

* **과도한 난이도 점프** → LRC 기준/추천 로직으로 방지, 갭 스코어 기반 제어
* **문제 중복감** → 컨텍스트/표현 로테이션, seed 블랙리스트
* **설명 평가 오류** → 키워드 기반+간단 임베딩 혼합, 교사 샘플 레이블로 튜닝

---

# 14. 수익화/GT(M) (Phase 1 기준)

* **Freemium**: 무료=각 코스 S1 무제한 + S2 일부(3개 스킬), 유료=전체 해금 + 부모 리포트 + 교사 콘솔
* **B2B(교습소)**: 교사용 대시보드/과제 배포/해설서/학부모 리포트 번들
* **전환 유도**: S2 2번째 완료 **직후** ‘다음 단계 해금’ 모달
* **콘텐츠 확장**: 경시 대비 팩, 상위 전이 팩(벡터, 수열 심화 등)

---

# 15. 수업·교재와의 연동(오프라인 시나리오)

* **페이지 악보(Teacher Score)**: 도입→탐구→전이→메타인지 15줄 대본
* **동형 3형제**: 생활/데이터/도형 3맥락 카드
* **전이 지도**: 보스전 전후로 **열린 스텝**을 교재 목차와 매칭

---

## 부록 A. 예시: 곱셈 스킬의 다중 연결

* `C01-S1` **요구**: `AS.MUL.POW10:1` (×10/×100 스케일 감각)
* `C03-S3` **요구**: `AS.MUL.TWOxONE:2`, `AS.MUL.FACTS:2` (두자리×한자리 계산)
* 두 스텝 완료 시 **teaches**로 곱셈 관련 AS 레벨이 상승 → `C07-S3(등차 합)` 등 **상위 스텝 잠금 해제**에 기여.

---

## 부록 B. Phase‑1 실행 체크리스트(10–12주)

### Week 1–2: 기반 구축
- [ ] C01/C03/C05 × S1/S2 스펙 확정(요구/보상/오개념/렌즈)
- [ ] AS 20개 확정 및 requires/teaches 매핑(6 스텝)
- [ ] 템플릿 10개 작성(C01‑S1), DAG 편집 워크플로우/버전 라벨 적용

### Week 3–4: UI·세션
- [ ] 트리 UI 1차(React Flow), 리스트 UI(접근성 기본 진입)
- [ ] 세션 플레이어 v1(퀵체크 포함)
- [ ] 템플릿 10개 추가(C03‑S1)

### Week 5–8: 진행도·보스·파일럿A
- [ ] XP/레벨/LRC(정확도만) 적용, 세션 종료 UX/보스 실패 리미디얼 UX
- [ ] 템플릿 10개 추가(나머지), 파일럿 A(20–40명)

### Week 9–12: 분석·베타
- [ ] IRT 데이터 수집(앵커 노출량 기준), 전환 모달, 부모 리포트 v1
- [ ] 베타 런칭(지표/KPI·장애 대응 플랜), 사례 리포트

---

## 부록 C. “천재적 아이디어” 12

1. **Lens Badge 튜토리얼**: 차분/누적/비율을 미니 게임으로 튜토리얼 → 렌즈 전환 습관화
2. **Isomorphic Triplets**: 같은 구조 3맥락(생활/표/도형)을 한 화면에서 토글
3. **Backwards Bridge**: 상위 개념(일차 그래프)을 먼저 보여주고 등차로 해체
4. **Anchor Items**: 판간 동일 문항 2–3개로 난이도 스케일 유지(IRT)
5. **Explain-first 박스**: 정답 전 필수 한줄 설명(키워드 자동 하이라이트)
6. **미시 스킬 60초 드릴**: 자리 정렬/차이 읽기/표→식 변환
7. **보스전 ‘전이 모의고사’**: 같은 구조 6문항, 맥락 6종
8. **AS 히트맵**: 학급/개인의 레벨 분포 히트맵으로 과제 자동 추천
9. **리미디얼 제안**: 부족 AS를 올려주는 **가장 가까운 CS** 버튼
10. **부모 리포트**: “이번 주 열린 문, 다음 주 열릴 문(예측)”
11. **교사용 악보**: 15줄 스크립트 + 판서 예시 + 오개념 처방
12. **콘텐츠 빈칸 탐지**: 개념×도메인 매트릭스로 미커버리지 자동 알림

---

### 마무리

우리 프로젝트의 **핵심 가치는 “전이”**입니다. 단순히 문제를 많이 풀게 하는 것이 아니라, **덧셈→등차→일차→평균변화율**로 **구조의 연쇄**를 경험하게 합니다. 이를 위해 **이중 레이어 DAG**, **LRC 게이트**, **자동 변형 엔진**, **렌즈 메타인지**를 하나의 시스템으로 엮었습니다.
지금 보유한 **graph.bipartite.json**을 소스로 프런트/백엔드/콘텐츠를 동시에 가동하고, 본 문서의 **Phase‑1(코스 3×S1/S2, 템플릿 30)**를 **10–12주 로드맵**에 따라 실행하면, 검증된 MVP로 **베타 출시**할 수 있습니다.

---

## 부록 D. 커리큘럼 전체 목록(요약) & Phase‑1 필수 AS(20)

### Phase‑1 코스(3) × 스텝(6)
- C01 덧셈
  - S1: 한 자리/두 자리 기초, 받아올림 전 단계
  - S2: 받아올림/세 자리 연산(표/수직선 브리지)
- C03 곱셈
  - S1: 구구단, ×10/×100 스케일 감각
  - S2: 두 자리×한 자리, 분배법칙 직관
- C05 분수
  - S1: 분수 개념/동치(약분·통분)
  - S2: 분수 덧셈/뺄셈(동분모 중심)

### Phase‑1 필수 AS(20)
- AS.ADD.BASIC, AS.ADD.CARRY, AS.MUL.FACTS, AS.MUL.POW10, AS.MUL.TWOxONE,
  AS.FRAC.CONCEPT, AS.FRAC.EQUIV, AS.FRAC.ADD, AS.FRAC.SUB, AS.FRAC.COMPARE,
  AS.TABLE.READ, AS.TABLE.DIFF, AS.LINE.SLOPE_INTUIT, AS.NUM.SCALE10,
  AS.TIME.UNIT, AS.MEASURE.LENGTH_UNIT, AS.SHAPE.RECT_AREA, AS.PATTERN.NEXT,
  AS.EXPLAIN.KEYWORDS, AS.A11Y.LIST_NAV

참고: 전체 12코스·AS 60~80개 개요 및 DAG 상세는 추후 Phase‑2 문서에서 단계적으로 공개합니다. 원본 데이터 경로는 `data/graph.bipartite.json`입니다.

---

## 부록 E. API 요약(요청/응답/에러 예시)

### GET /api/v1/skills/tree
요청
```
GET /api/v1/skills/tree?user_id={user_id}
Authorization: Bearer {token}
```
성공(200)
```json
{
  "graph": {
    "version": "2025-11-10T14:30:00Z",
    "nodes": [
      {"id":"C01-S1","label":"덧셈 기초","type":"course_step","requires":[{"skill_id":"AS.ADD.BASIC","min_level":1}],"teaches":[{"skill_id":"AS.ADD.BASIC","delta_level":1}]}
    ],
    "edges": []
  },
  "progress": {"AS.ADD.BASIC": {"level": 1, "xp": 50}},
  "unlocked": {"C01-S1": true, "C01-S2": false}
}
```
오류(RFC 9457)
```json
{ "type": "https://example.com/errors/unauthorized", "title": "Unauthorized", "status": 401, "detail": "Missing or invalid authentication token" }
```

### GET /api/v1/problems/generate
요청 파라미터(예)
```
op=add|sub|mul|div&digits=1..3&count=1..50&seed=123
```
성공(200) — MQG‑P1 관련 필드 포함
```json
{
  "op":"mul","digits":2,"count":20,
  "items":[{"id":1,"question":"23×5=?"}],
  "seed":123,
  "constraints_passed": true,
  "difficulty_hint": "easy|medium|hard"
}
```
참고: 상세 스펙은 `docs/api/api_spec_v1.0.md` 및 `api/openapi.yaml`(추가 예정)을 참조합니다.
