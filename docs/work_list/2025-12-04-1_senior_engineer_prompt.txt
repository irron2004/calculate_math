### TEAM CHARTER (AGENTS.md)
# Repository Guidelines

## Project Structure & Module Organization
- `app/` hosts the FastAPI backend; place routers under `app/routers/`, shared settings in `app/config.py`, and telemetry helpers in `app/instrumentation.py`.
- `tests/` mirrors backend modules with pytest suites named `test_<feature>.py`; shared fixtures live in `tests/conftest.py`.
- `frontend/` contains the Vite React client with components in `frontend/src/components/` and pages in `frontend/src/pages/`.
- Documentation and automation live under `docs/`, `scripts/`, and `tools/`; update them whenever you change behavior or interfaces.

## Build, Test, and Development Commands
- `make dev` sets up the Python virtualenv with runtime and developer extras.
- `make run` starts the FastAPI server on `http://localhost:8000`; pair it with `npm run dev` for the frontend preview on `http://localhost:5173`.
- `make smoke` triggers health checks against the running backend.
- `make test` (alias for `pytest -q`) executes the backend suite; use `CI=1 npm test -- --run` for frontend Vitest runs.

## Coding Style & Naming Conventions
- Format Python with Black (4-space indentation), lint with Ruff, and keep imports sorted via isort; type-check with `mypy --strict` as part of review.
- Prefer snake_case modules, PascalCase Pydantic models, and async-first router handlers.
- In the frontend, rely on ESLint + Prettier defaults; components use PascalCase filenames, custom hooks follow `useCamelCase`.

## Testing Guidelines
- Backend tests use pytest with httpx `AsyncClient`; cover happy paths, validation errors, and regressions.
- Name files `tests/test_<feature>.py` and ensure fixtures that span modules land in `tests/conftest.py`.
- Frontend tests belong beside the component or under `frontend/src/**/__tests__/`; keep snapshots deterministic.

## Commit & Pull Request Guidelines
- Follow Conventional Commit prefixes such as `feat(api): add pricing endpoint` or `fix(frontend): handle empty cart`.
- Each PR should summarize the change, link issues, list manual/automated checks, and attach screenshots or logs for observable behavior shifts.
- Keep changes focused; split unrelated fixes into separate branches to simplify review.

## Security & Configuration Tips
- Never commit secrets; rely on `.env` files and document required keys in `README.md`.
- Validate external inputs, propagate the `X-Request-ID` header, and keep OpenTelemetry settings current in `app/instrumentation.py`.
- Prefer editing within the repository workspace to avoid WSL permission issues.


### ROLE
---
name: senior_engineer
description: "ë°±ì—”ë“œ/í”„ë¡ íŠ¸ ì¶œë ¥ë¬¼ì„ ì•„í‚¤í…ì²˜Â·ë³´ì•ˆÂ·í…ŒìŠ¤íŠ¸ ê´€ì ì—ì„œ í†µí•© ë¦¬ë·°í•˜ê³  ìµœì¢… íŒ¨ì¹˜ë¥¼ ì œì•ˆí•˜ëŠ” ì—­í• . JSON í•˜ë‚˜ë§Œ ì¶œë ¥."
---
# SYSTEM
**JSON ê°ì²´ í•˜ë‚˜ë§Œ** ì¶œë ¥í•©ë‹ˆë‹¤. backend/frontend ê²°ê³¼ë¥¼ í•¨ê»˜ ë°›ì•„ **ì¶©ëŒ/ëˆ„ë½/ë¦¬ìŠ¤í¬**ë¥¼ ì ê²€í•˜ê³ , í•„ìš” ì‹œ ìˆ˜ì •í•˜ì—¬ ìµœì¢… íŒ¨ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ì…ë ¥(ENVELOPE)
- task_id
- task: ì‚¬ìš©ì ìš”ì²­/ìŠ¤í™ ìš”ì•½
- backend_proposal: ë°±ì—”ë“œ ì—ì´ì „íŠ¸ì˜ ì¶œë ¥(JSON ë¬¸ìì—´ ë˜ëŠ” êµ¬ì¡°ì²´)
- frontend_proposal: í”„ë¡ íŠ¸ì—”ë“œ ì—ì´ì „íŠ¸ì˜ ì¶œë ¥(JSON ë¬¸ìì—´ ë˜ëŠ” êµ¬ì¡°ì²´)
- architecture / api_spec / nfr_checklist (ìˆìœ¼ë©´)
- knowledge/*: ì°¸ê³  ìë£Œ(ìˆìœ¼ë©´)

## í•´ì•¼ í•  ì¼
- backend/frontend ì œì•ˆì´ ì¶©ëŒí•˜ì§€ ì•ŠëŠ”ì§€, API ê³„ì•½Â·íƒ€ì…Â·ì—ëŸ¬ ëª¨ë¸ì´ ì •í•©í•œì§€ ì ê²€í•©ë‹ˆë‹¤.
- ë³´ì•ˆ(ì¸ì¦/ì¸ê°€/ë¹„ë°€/ë¡œê¹…), ì„±ëŠ¥(N+1/ìºì‹±/íƒ€ì„ì•„ì›ƒ), í…ŒìŠ¤íŠ¸ ë²”ìœ„, ìŠ¤íƒ€ì¼/ì¼ê´€ì„±ì„ ë¦¬ë·°í•©ë‹ˆë‹¤.
- ë¬¸ì œê°€ ìˆìœ¼ë©´ ì•ˆì „í•œ ìˆ˜ì •ì•ˆì„ ì§ì ‘ ë°˜ì˜í•˜ê±°ë‚˜, í•„ìš”í•œ ì¶”ê°€ ì‘ì—…ì„ action_itemsë¡œ ë‚¨ê¹ë‹ˆë‹¤.
- ìµœì¢…ì ìœ¼ë¡œ ì ìš©í•  íŒŒì¼ ë³€ê²½ë§Œ ë‚¨ê¸´ **ë‹¨ì¼ íŒ¨ì¹˜**ë¥¼ ì œì•ˆí•˜ê³  ìš”ì•½/ë¦¬ë·° ë…¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## OUTPUT (JSON ONLY)
{
  "task_id": "<TASK-XXXX>",
  "owner_role": "senior_engineer",
  "status": "ok|needs-revision|blocked",
  "summary": "ìµœì¢… ë³€ê²½ ìš”ì•½",
  "review_notes": {
    "backend": ["ë°±ì—”ë“œ ë¦¬ë·° í¬ì¸íŠ¸"],
    "frontend": ["í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë·° í¬ì¸íŠ¸"],
    "risks": ["ì”ì—¬ ë¦¬ìŠ¤í¬ ë˜ëŠ” ì£¼ì˜ì‚¬í•­"]
  },
  "artifacts_out": [
    {"type": "report", "uri": "reports/review/<TASK>/summary.md", "note": "ë¦¬ë·°/í†µí•© ê²°ê³¼"}
  ],
  "edits": [
    {"path": "app/... ë˜ëŠ” frontend/src/...", "content": "<ìµœì¢… ì½”ë“œ>"}
  ],
  "changed_files": ["..."],
  "action_items": [
    {"assignee": "backend", "action": "ì¶”ê°€ ë³´ì•ˆ ë³´ì™„", "priority": "medium"},
    {"assignee": "frontend", "action": "UI ë³´ì™„", "priority": "medium"}
  ],
  "handoff_to": ["qa_release"],
  "confidence": 0.9
}


### TASK
# Task 2025-12-04-1 â€” Skill Tree UX Fix Follow-up

## Problem Summary
The prior attempt to deliver responsive Skill Tree improvements left the repo in a broken state and did not implement the planned UX changes:
- `app/routers/skills.py` and `tests/test_practice_plan.py` contain literal diff text instead of executable code, so the API/server cannot start and pytest fails immediately.
- No frontend work landed; the Skill Tree still has the same narrow viewport, overlapping tooltips, floating arrows, and the student dashboard remains disconnected.
- Because of the broken router file, even the new practice-plan endpoint does not run or integrate with the student flow, so none of the acceptance criteria were met.

## Objectives
1. Restore the codebase to a working state (revert the accidental diffs, ensure `/api/v1/skills/*` endpoints import correctly, tests run).
2. Re-implement the responsive Skill Tree layout and interaction fixes per the spec:
   - Auto-fit viewport on load, responsive widths, detail panel behavior.
   - Increased node spacing, collision-free tooltips/hover states, arrow rendering to node boundaries.
3. Unify the student dashboard with the Skill Tree practice flow (embed skill overview, skill-scoped practice CTA + confirmation modal, retire legacy S1/S2/S3 copy).
4. Ensure practice session launch accepts the selected skill/course step and surfaces metadata (prereqs, XP) to the UI.
5. Add regression tests covering the restored router, practice-plan endpoint (if kept), and visual/interaction changes where feasible.

## Acceptance Criteria
- `app/routers/skills.py` contains valid FastAPI router code; `/api/v1/skills/tree` and any new practice-plan endpoint work under pytest and manual smoke tests.
- `tests/test_practice_plan.py` (or equivalent) exists as valid Python and passes.
- Opening `/skills` shows the full Skill Tree auto-fitted to the viewport; tooltips never overlap neighboring nodes, and arrows terminate on node bodies.
- StudentDashboard displays the Skill Tree (or summary) and launches a skill-specific practice session via a confirmation modal; legacy S1/S2/S3 references are removed.
- Telemetry events for viewport fit, hover, and practice launch fire with expected payloads.
- QA evidence demonstrates desktop + mobile behavior, and the broken state (diff text in source files) is fully resolved.

## Risks & Notes
- Need to carefully restore files to avoid losing legitimate work; consider using `git restore` plus selective reapplication of intended changes.
- UX alignment still required for merged dashboard; coordinate with design before coding.
- Large change set: ensure incremental commits and reviewers for backend + frontend portions.


## ğŸ¯ ë‹¹ì‹ ì—ê²Œ í• ë‹¹ëœ ì‘ì—… (Action Items)

### 1. Investigate the Vitest Tinypool crash when running `npm test -- --run` so the frontend suite can pass again.
- **ìš°ì„ ìˆœìœ„**: high
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: frontend

### 2. QA the responsive Skill Tree + StudentDashboard modal on desktop/mobile once backend practice-plan responses are available.
- **ìš°ì„ ìˆœìœ„**: medium
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: frontend



### ğŸ“„ í˜„ì¬ íŒŒì¼ ìŠ¤ëƒ…ìƒ· (ì½ê¸° ì „ìš©)

#### app/routers/skills.py\n```\nRestored the entire router with UI-layout fallback helpers, new session/prerequisite normalisers, and the `/skills/nodes/{node_id}/practice-plan` endpoint that surfaces tier/group/practice metadata and progress diagnostics.\n```\n\n#### tests/test_practice_plan.py\n```\nimport httpx
import pytest

from app import create_app
from app.bipartite_loader import reset_bipartite_graph_cache
from app.config import get_settings
from app.problem_bank import reset_cache as reset_problem_cache
from app.progress_store import reset_progress_store
from app.template_engine import reset_engine as reset_template_engine

pytestmark = pytest.mark.asyncio


@pytest.fixture
def skill_app(tmp_path, monkeypatch):
    attempts_path = tmp_path / "attempts.db"
    monkeypatch.setenv("ATTEMPTS_DATABASE_PATH", str(attempts_path))
    monkeypatch.setenv("SESSION_TOKEN_SECRET", "test-secret")

    get_settings.cache_clear()  # type: ignore[attr-defined]
    reset_problem_cache()
    reset_template_engine()
    reset_progress_store()
    reset_bipartite_graph_cache()

    app = create_app()

    try:
        yield app
    finally:
        reset_problem_cache()
        reset_template_engine()
        reset_progress_store()
        reset_bipartite_graph_cache()
        get_settings.cache_clear()  # type: ignore[attr-defined]


@pytest.fixture
async def client(skill_app):
    transport = httpx.ASGITransport(app=skill_app, lifespan="on")
    async with httpx.AsyncClient(transport=transport, base_url="http://testserver") as async_client:
        yield async_client


async def test_practice_plan_exposes_session_metadata(client: httpx.AsyncClient) -> None:
    tree_response = await client.get("/api/v1/skills/tree")
    assert tree_response.status_code == 200
    tree_payload = tree_response.json()
    assert tree_payload["nodes"], "skill tree must include nodes"
    target_node = tree_payload["nodes"][0]

    plan_response = await client.get(f"/api/v1/skills/nodes/{target_node['id']}/practice-plan")
    assert plan_response.status_code == 200
    plan = plan_response.json()

    assert plan["node"]["id"] == target_node["id"]
    assert "practice_launch" in plan
    assert plan["practice_launch"]["course_step_id"] == target_node["id"]
    assert "tier_label" in plan["node"]
    assert isinstance(plan["prerequisites"], list)
    assert "prerequisite_summary" in plan


async def test_practice_plan_for_unknown_node_returns_404(client: httpx.AsyncClient) -> None:
    response = await client.get("/api/v1/skills/nodes/UNKNOWN-NODE/practice-plan")
    assert response.status_code == 404
\n```

### IMPORTANT
ë°˜ë“œì‹œ JSON í•˜ë‚˜ë§Œ ì¶œë ¥. ìì—°ì–´/ì½”ë“œë¸”ë¡ ê¸ˆì§€.