### TEAM CHARTER (AGENTS.md)
# Repository Guidelines

## Project Structure & Module Organization
- `app/` hosts the FastAPI backend; place routers under `app/routers/`, shared settings in `app/config.py`, and telemetry helpers in `app/instrumentation.py`.
- `tests/` mirrors backend modules with pytest suites named `test_<feature>.py`; shared fixtures live in `tests/conftest.py`.
- `frontend/` contains the Vite React client with components in `frontend/src/components/` and pages in `frontend/src/pages/`.
- Documentation and automation live under `docs/`, `scripts/`, and `tools/`; update them whenever you change behavior or interfaces.

## Build, Test, and Development Commands
- `make dev` sets up the Python virtualenv with runtime and developer extras.
- `make run` starts the FastAPI server on `http://localhost:8000`; pair it with `npm run dev` for the frontend preview on `http://localhost:5173`.
- `make smoke` triggers health checks against the running backend.
- `make test` (alias for `pytest -q`) executes the backend suite; use `CI=1 npm test -- --run` for frontend Vitest runs.

## Coding Style & Naming Conventions
- Format Python with Black (4-space indentation), lint with Ruff, and keep imports sorted via isort; type-check with `mypy --strict` as part of review.
- Prefer snake_case modules, PascalCase Pydantic models, and async-first router handlers.
- In the frontend, rely on ESLint + Prettier defaults; components use PascalCase filenames, custom hooks follow `useCamelCase`.

## Testing Guidelines
- Backend tests use pytest with httpx `AsyncClient`; cover happy paths, validation errors, and regressions.
- Name files `tests/test_<feature>.py` and ensure fixtures that span modules land in `tests/conftest.py`.
- Frontend tests belong beside the component or under `frontend/src/**/__tests__/`; keep snapshots deterministic.

## Commit & Pull Request Guidelines
- Follow Conventional Commit prefixes such as `feat(api): add pricing endpoint` or `fix(frontend): handle empty cart`.
- Each PR should summarize the change, link issues, list manual/automated checks, and attach screenshots or logs for observable behavior shifts.
- Keep changes focused; split unrelated fixes into separate branches to simplify review.

## Security & Configuration Tips
- Never commit secrets; rely on `.env` files and document required keys in `README.md`.
- Validate external inputs, propagate the `X-Request-ID` header, and keep OpenTelemetry settings current in `app/instrumentation.py`.
- Prefer editing within the repository workspace to avoid WSL permission issues.


### ROLE
---
name: security
description: "ë³´ì•ˆ/í”„ë¼ì´ë²„ì‹œ ê´€ì ì—ì„œ ì„¤ê³„ì™€ êµ¬í˜„ì„ ê²€í† í•˜ëŠ” ì—­í• . JSON í•˜ë‚˜ë§Œ ì¶œë ¥."
---
# SYSTEM
ë‚´ë¶€ ì‚¬ê³  ê³¼ì •ì€ ìˆ¨ê¸°ê³  **JSON ê°ì²´ í•˜ë‚˜ë§Œ** ì¶œë ¥í•˜ì„¸ìš”.

## ì…ë ¥(ENVELOPE)
- task_id
- architecture / api_spec / ì½”ë“œ ë³€ê²½ ìš”ì•½
- nfr_checklist: ë³´ì•ˆ/ì»´í”Œë¼ì´ì–¸ìŠ¤ ìš”êµ¬
- dependencies_report / vuln_scan ê²°ê³¼(ìˆìœ¼ë©´)
- knowledge/*: ì°¸ê³  ìë£Œ(ìˆìœ¼ë©´)

## í•´ì•¼ í•  ì¼
- ì…ë ¥ ê²€ì¦, ì¸ì¦/ì¸ê°€, ê¶Œí•œ ë¶„ë¦¬, ë¹„ë°€/í‚¤ ê´€ë¦¬(ì˜ˆ: vault), ì•ˆì „í•œ ì„¸ì…˜/ì¿ í‚¤ ì„¤ì • ì—¬ë¶€ë¥¼ ì ê²€í•©ë‹ˆë‹¤.
- ë¡œê·¸/ëª¨ë‹ˆí„°ë§ì—ì„œ PII ë§ˆìŠ¤í‚¹, ê°ì‚¬ ì¶”ì , ìµœì†Œ ê¶Œí•œ, ë°ì´í„° ë³´í˜¸(ì•”í˜¸í™”/ìˆ˜ëª…ì£¼ê¸°)ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
- ì¢…ì†ì„± ì·¨ì•½ì (SCA), ì •ì /ë™ì  ë¶„ì„(SAST/DAST) í•„ìš” í•­ëª©, ìœ„í˜‘ ëª¨ë¸/ê³µê²© í‘œë©´ì„ ì •ë¦¬í•©ë‹ˆë‹¤.
- ë¬¸ì œê°€ ìˆìœ¼ë©´ ìˆ˜ì • í•„ìš” ì‚¬í•­ì„ action_itemsë¡œ ëª…ì‹œí•˜ê³ , ë‹¤ìŒ ë‹¨ê³„(qa_release/executive) ì „ë‹¬ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.

## OUTPUT (JSON ONLY)
{
  "task_id": "<TASK-XXXX>",
  "owner_role": "security",
  "status": "ok|needs-revision|blocked",
  "artifacts_out": [
    {"type": "doc", "uri": "docs/THREAT_MODEL.md", "note": "Threat model"},
    {"type": "doc", "uri": "docs/SECURITY_REPORT.md", "note": "Security review report"}
  ],
  "risks": ["..."],
  "action_items": [
    {"assignee": "backend|frontend|devops", "action": "...", "priority": "low|medium|high"}
  ],
  "handoff_to": ["qa_release", "executive"],
  "confidence": 0.9
}


### TASK
# Senior Engineer Report â€” Task 2025-12-02-1

## 1. Context & Planning Alignment
- ê¸°íšì„œëŠ” ì²« í™”ë©´ì„ â€œë””ì•„ë¸”ë¡œì‹ ìŠ¤í‚¬ íŠ¸ë¦¬â€ë¡œ ì „í™˜í•˜ê³  ëª¨ë°”ì¼ ê¸°ì¤€ TTI â‰¤ 3ì´ˆÂ·ì´ˆê¸° ë Œë” 50msë¥¼ OKRë¡œ ëª…ì‹œí•©ë‹ˆë‹¤.*(docs/pm/ê¸°íšì•ˆ.md:1, docs/pm/ê¸°íšì•ˆ.md:10, docs/pm/ê¸°íšì•ˆ.md:12)*
- ë°±ì—”ë“œ Epic BëŠ” `/api/v1/skills/tree`ì™€ `/api/v1/skills/progress`ë¥¼ ì§„í–‰ë„ í¬í•¨ JSONìœ¼ë¡œ ì œê³µí•˜ê³  ìºì‹œÂ·í…ŒìŠ¤íŠ¸ë¥¼ ê°–ì¶”ë¼ê³  ìš”êµ¬í•©ë‹ˆë‹¤.*(docs/pm/ê¸°íšì•ˆ.md:45-53)*
- í”„ëŸ°íŠ¸ Epic CëŠ” íŒ¬/ì¤Œ/í‚¤ë³´ë“œ ë‚´ë¹„, ëª…í™•í•œ ìƒíƒœ ë°°ì§€, ì ‘ê·¼ì„± ë³´ì¥ì„ í•„ìˆ˜ë¡œ í•©ë‹ˆë‹¤.*(docs/pm/ê¸°íšì•ˆ.md:55-62)*

## 2. Backend Snapshot
### 2.1 í˜„ì¬ ë™ì‘ ê°œìš”
- FastAPI ì•±ì€ `app/__init__.py`ì—ì„œ ë¬¸ì œ/í…œí”Œë¦¿/ê·¸ë˜í”„/ì§„í–‰ë„ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìˆ˜ëª…ì£¼ê¸° ë™ì•ˆ ì¤€ë¹„í•˜ê³  OpenTelemetry ë¯¸ë“¤ì›¨ì–´Â·SPA fallbackê¹Œì§€ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- `/api/v1/skills/tree`ëŠ” bipartite ê·¸ë˜í”„ì™€ ì§„í–‰ë„ ìŠ¤ëƒ…ìƒ·ì„ `build_skill_tree_projection`ìœ¼ë¡œ ë³€í™˜í•´ UI/ì‹¤í—˜ ì •ë³´ë¥¼ ë‚´ë ¤ì¤ë‹ˆë‹¤.*(app/routers/skills.py:162-223)*

### 2.2 ì‹ë³„ëœ ë¦¬ìŠ¤í¬ & ê°œì„  ê³¼ì œ
1. **ê¸°ë³¸ ë°ì´í„° íŒ¨í‚¤ì§• ë¶€ì¬**  
   - ì„¤ì •ì€ ë¬¸ì œÂ·DAGÂ·ì§„í–‰ë„ íŒŒì¼ì„ `app/data/*.json` ê¸°ë³¸ ê²½ë¡œë¡œ ê¸°ëŒ€í•˜ì§€ë§Œ ì €ì¥ì†Œì—ëŠ” `.old` í•˜ìœ„ì—ë§Œ ì‹¤ì œ JSONì´ ìˆì–´ ëŸ°íƒ€ì„ FileNotFoundê°€ ë°œìƒí•©ë‹ˆë‹¤.*(app/config.py:10-18, app/config.py:133-150)*  
   - âœ… `app/data`ë¡œ ìµœì‹  JSONì„ ì´ë™í•˜ê±°ë‚˜ ê¸°ë³¸ ê²½ë¡œë¥¼ `.old` ìœ„ì¹˜ë¡œ ì¡°ì •í•˜ê³ , íŒŒì¼ ë¯¸ì¡´ì¬ ì‹œ ìµœì†Œí•œ seed/fixtureë¡œ ëŒ€ì²´í•˜ë„ë¡ ë¡œë”/health ì²´í¬ë¥¼ ë³´ê°•í•´ì•¼ í•©ë‹ˆë‹¤.

2. **Skill UI ê·¸ë˜í”„ í•„ìˆ˜ ì˜ì¡´ì„±**  
   - `/api/v1/skills/tree`ëŠ” `_SKILL_UI_PATH`ë¥¼ ê°•ì œí•˜ê³ , íŒŒì¼ì´ ì—†ìœ¼ë©´ ì¦‰ì‹œ `SkillSpecError`ë¥¼ ë˜ì§‘ë‹ˆë‹¤.*(app/routers/skills.py:39-78)*  
   - í˜„ì¬ ì €ì¥ë³¸ì—ëŠ” `app/data/skills.ui.json`ì´ ì—†ì–´ APIê°€ graph ì—†ì´ ë¹ˆ payloadë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. bipartite projectionì„ ê·¸ëŒ€ë¡œ `graph` í•„ë“œì— fallback í•˜ê±°ë‚˜, UI ê·¸ë˜í”„ë¥¼ ë¦¬í¬ build ë‹¨ê³„ì— í¬í•¨ì‹œí‚¤ëŠ” ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.

3. **ì§„í–‰ë„ ìŠ¤í† ì–´/ìºì‹œ ì˜µì €ë²„ë¹Œë¦¬í‹° ë¶€ì¡±**  
   - ì§„í–‰ë„ ë¡œë”© ì‹¤íŒ¨ ì‹œ ë‹¨ìˆœíˆ `progress_error` ë©”ì‹œì§€ì— ë¨¸ë¬¼ê³ , storeê°€ ì™„ì „íˆ ë¹„ì–´ìˆìœ¼ë©´ ì²« ë²ˆì§¸ user_idë¥¼ ì„ì˜ ì‚¬ìš©í•©ë‹ˆë‹¤.*(app/routers/skills.py:100-210)*  
   - ê¸°ë³¸ ë°ì´í„°ê°€ ì—†ì„ ë•Œì˜ ë‹¨ê³„ë³„ fallbackê³¼ ë©”íŠ¸ë¦­(exporter) ì„ ì¶”ê°€í•´ root cause íŒŒì•…ì„ ì‰½ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤.

4. **ì¸ì¦/ì„¸ì…˜ ë³´ì•ˆ ë¯¸í¡**  
   - ë¡œê·¸ì¸ì€ ë‹¨ìˆœ SHA-256 í•´ì‹œë¥¼ ì‚¬ìš©í•˜ê³ , `SESSION_COOKIE_SECURE` ê¸°ë³¸ê°’ì´ Falseë¼ HTTPSê°€ ì•„ë‹Œ í™˜ê²½ì—ì„œ ì„¸ì…˜ì´ ë…¸ì¶œë©ë‹ˆë‹¤.*(app/routers/practice.py:87-101, app/config.py:155-158)*  
   - Argon2/Bcrypt, pepper/iteration ê´€ë¦¬, ìµœì†Œ rate limitì„ ì¶”ê°€í•˜ê³  ê¸°ë³¸ secure/samesite=strict ì •ì±…ì„ ê°•ì œí•´ì•¼ í•©ë‹ˆë‹¤.

## 3. Frontend Snapshot
### 3.1 í˜„ì¬ êµ¬í˜„
- `SkillTreePage`ëŠ” API ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ íŒ¬Â·ì¤ŒÂ·ê³ ëŒ€ë¹„Â·í¬ì»¤ìŠ¤ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, payloadì— `skills` ë°°ì—´ë§Œ ìˆì„ ê²½ìš° ê°„ì´ íŠ¸ë¦¬ë¥¼ ê·¸ë¦½ë‹ˆë‹¤.*(frontend/src/components/SkillTreePage.tsx:285-401)*  
- ì—ëŸ¬ ë°œìƒ ì‹œì—ëŠ” ë‹¨ìˆœ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ë’¤ë¡œê°€ê¸° ë§í¬ë§Œ ì œê³µë©ë‹ˆë‹¤.*(frontend/src/components/SkillTreePage.tsx:381-399)*
- API í´ë¼ì´ì–¸íŠ¸ëŠ” `VITE_SKILL_TREE_MODE`ì˜ ê¸°ë³¸ê°’ì„ `live`ë¡œ ì„¤ì •í•´ ë°±ì—”ë“œ ì‹¤íŒ¨ ì‹œì—ëŠ” seed fallback ì—†ì´ ë°”ë¡œ ì˜¤ë¥˜ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤.*(frontend/src/utils/api.ts:64-96)*

### 3.2 ê°œì„  í¬ì¸íŠ¸
1. **Seed/Auto Fallback ìƒì‹œ í™œì„±í™”**  
   - ë¸Œë¼ìš°ì €ê°€ ì²« ë°©ë¬¸ì—ì„œ ë¹ˆ payloadë¥¼ ë°›ìœ¼ë©´ ê¸°íšì„œì˜ â€œì²« í™”ë©´ ìŠ¤í‚¬ íŠ¸ë¦¬â€ ê²½í—˜ì„ ì œê³µí•˜ì§€ ëª»í•©ë‹ˆë‹¤. ê¸°ë³¸ ëª¨ë“œë¥¼ `auto-seed`ë¡œ ë°”ê¾¸ê³ , API ì‹¤íŒ¨ ì‹œ seed ë°ì´í„°ë¥¼ ì¦‰ì‹œ ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤.
2. **ë ˆì´ì•„ì›ƒ/ì„±ëŠ¥ ìµœì í™”**  
   - í˜„ì¬ëŠ” ë°±ì—”ë“œê°€ ë‚´ë ¤ì£¼ëŠ” `graph`ê°€ ì—†ìœ¼ë©´ ë§¤ ë Œë”ë§ˆë‹¤ fallback gridë¥¼ ì¬ì¡°ë¦½í•©ë‹ˆë‹¤.*(frontend/src/components/SkillTreePage.tsx:475-520)*  
   - ë°±ì—”ë“œê°€ precomputed UI ë ˆì´ì•„ì›ƒì„ ë³´ì¥í•˜ë„ë¡ í•˜ê±°ë‚˜, í”„ëŸ°íŠ¸ê°€ React Flow/ELKë¥¼ ì§€ì—° ë¡œë“œí•˜ì—¬ TTI â‰¤ 3ì´ˆ ëª©í‘œë¥¼ ì§€í‚¬ ìˆ˜ ìˆê²Œ í•´ì•¼ í•©ë‹ˆë‹¤.
3. **ì˜¤ë¥˜/ë¹ˆ ìƒíƒœ UX ê°•í™”**  
   - ê¸°íšì„œì—ì„œ ê°•ì¡°í•œ í•™ìŠµ íë¦„ì„ ì‚´ë¦¬ë ¤ë©´ ì—ëŸ¬ ì¹´ë“œ ëŒ€ì‹  seed ê·¸ë˜í”„/ê°€ì´ë“œ ë§í¬ë¥¼ ë…¸ì¶œí•˜ê³  í…”ë ˆë©”íŠ¸ë¦¬ë¥¼ ë‚¨ê²¨ì•¼ í•©ë‹ˆë‹¤.

## 4. Recommended Next Steps
1. **ë°ì´í„° ìì‚° ë²ˆë“¤ë§** â€“ CI/ë°°í¬ íŒŒì´í”„ë¼ì¸ì—ì„œ `app/data/.old` ë‚´ìš©ì„ ìµœì‹  ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ìŠ¹ê²©í•˜ê³  health-checkì—ì„œ ì¡´ì¬ ì—¬ë¶€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2. **Skill Tree API íƒ„ë ¥ì„±** â€“ `_load_skill_ui_graph` ëŒ€ì‹  projection ê¸°ë°˜ fallbackì„ ë„ì…í•˜ê³ , graph ë²„ì „ì„ ìƒíƒœì— í¬í•¨ì‹œì¼œ í”„ëŸ°íŠ¸ ìºì‹œë¥¼ ëª…í™•íˆ í•©ë‹ˆë‹¤.
3. **ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ ì¸ì¦ ë¦¬íŒ©í„°ë§** â€“ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œ êµì²´, secure ì¿ í‚¤ ê¸°ë³¸ ì ìš©, `/api/v1/login` rate limiting ë° ê°ì‚¬ ë¡œê·¸ ì¶”ê°€.
4. **í”„ëŸ°íŠ¸ fallback/ì„±ëŠ¥ ê°œì„ ** â€“ `auto-seed` ê¸°ë³¸í™”, ì—ëŸ¬/ë¹ˆ ìƒíƒœ UX ê°œì„ , precomputed layout ì‚¬ìš© í˜¹ì€ React Flow lazy loadë¡œ ì´ˆê¸° ë¹„ìš© ì ˆê°.
5. **ê´€ì¸¡ì„± ë° QA** â€“ ìŠ¤í‚¬ íŠ¸ë¦¬ ë¡œë”© ì‹¤íŒ¨/seed fallback ì‚¬ìš© ì—¬ë¶€ë¥¼ OTEL ë©”íŠ¸ë¦­ê³¼ GA ì´ë²¤íŠ¸(`skill_tree_fallback`)ë¡œ ì¸¡ì •í•˜ê³ , QAê°€ ê¸°ë³¸ ë°ì´í„°/seed ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í¬í•¨í•œ íšŒê·€ë¥¼ ìˆ˜í–‰í•˜ê²Œ í•©ë‹ˆë‹¤.

ì´ ë³´ê³ ì„œë¥¼ `tasks/2025-12-02-1_handoff.json`ê³¼ í•¨ê»˜ í›„ì† ì²´ì¸(backendâ†’securityâ†’frontendâ†’QAâ†’senior engineer)ì— ê³µìœ í•´ ì¡°ì¹˜í•©ë‹ˆë‹¤.


## ğŸ¯ ë‹¹ì‹ ì—ê²Œ í• ë‹¹ëœ ì‘ì—… (Action Items)

### 1. ë¡œê·¸ì¸ í•´ì‹œë¥¼ bcrypt/argon2ë¡œ êµì²´í•˜ê³  SESSION_COOKIE_SECURE ê¸°ë³¸ True, ë¡œê·¸ì¸ rate limit ì ìš©
- **ìš°ì„ ìˆœìœ„**: high
- **ë§ˆê°ì¼**: 2025-12-09
- **ì¶œì²˜**: handoff
- **ì°¸ê³  ë…¸íŠ¸**: í•„ìˆ˜ ë°ì´í„°(JSON) ëˆ„ë½ìœ¼ë¡œ ë°±ì—”ë“œ ê¸°ë™ê³¼ /api/v1/skills/treeê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ë¹ˆ payloadë¥¼ ë‚´ë ¤ í”„ëŸ°íŠ¸ê°€ ë¹„ì–´ ë³´ì´ëŠ” ë¬¸ì œë¥¼ í•´ì†Œí•˜ê³ , ë¡œê·¸ì¸ ë³´ì•ˆì„ ê°•í™”í•˜ë©° í”„ëŸ°íŠ¸ SkillTreePageì— seed/auto-seed fallbackì„ ê¸°ë³¸ ì ìš©í•©ë‹ˆë‹¤.

### 2. bcrypt/argon2 í•´ì‹œ ë° secure cookie/rate limitì´ ì‹¤ì œë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í…ŒìŠ¤íŠ¸ ì¦ì ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.
- **ìš°ì„ ìˆœìœ„**: high
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: qa_release

### 3. Replace SHA-256 login hashing with bcrypt/argon2, enforce secure/samesite cookies, and add login rate limiting (app/routers/practice.py:90).
- **ìš°ì„ ìˆœìœ„**: high
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: senior_engineer

### 4. Replace SHA-256 login hashing with Argon2/Bcrypt, enforce secure SameSite cookies, and add login rate limiting per the epic.
- **ìš°ì„ ìˆœìœ„**: high
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: senior_engineer
- **ì‚°ì¶œë¬¼**: [{'type': 'report', 'uri': 'reports/review/2025-12-02-1/summary.md', 'note': 'Consolidated review findings'}]

### 5. Review the libargon2-based password migration, HTTPS-only cookie enforcement, and updated threat/SECURITY docs before rollout.
- **ìš°ì„ ìˆœìœ„**: medium
- **ë§ˆê°ì¼**: TBD
- **ì¶œì²˜**: backend
- **ì‚°ì¶œë¬¼**: [{'type': 'test', 'uri': 'pytest', 'note': 'pytest -q'}]



### ğŸ“„ í˜„ì¬ íŒŒì¼ ìŠ¤ëƒ…ìƒ· (ì½ê¸° ì „ìš©)

#### app/__init__.py\n```\nimport logging
from contextlib import asynccontextmanager
from pathlib import Path
from time import time

from fastapi import FastAPI, Request
from fastapi.responses import FileResponse
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from starlette.exceptions import HTTPException as StarletteHTTPException

from .config import get_settings
from .dag_loader import reset_graph_cache
from .bipartite_loader import reset_bipartite_graph_cache
from .instrumentation import RequestContextMiddleware, configure_telemetry
from .problem_bank import refresh_cache, reset_cache
from .template_engine import refresh_engine, reset_engine
from .repositories import (
    AttemptRepository,
    LRCRepository,
    SessionRepository,
    UserRepository,
)
from .routers import (
    bridge,
    curriculum,
    dag,
    health,
    invites,
    metrics,
    pages,
    practice,
    problems,
    skill_problems,
    skills,
)
from .progress_store import (
    refresh_progress_store,
    reset_progress_store,
)


startup_logger = logging.getLogger("calculate_service.startup")


def create_app() -> FastAPI:
    """Create and configure the FastAPI application instance."""
    settings = get_settings()

    @asynccontextmanager
    async def lifespan(app: FastAPI):
        startup_logger.debug("lifespan setup start for app id=%s", id(app))
        app.state.start_time = time()
        startup_logger.debug(
            "refreshing problem cache from %s", settings.problem_data_path
        )
        problem_repository = refresh_cache(force=True)
        startup_logger.debug("problem cache ready with %d items", len(problem_repository))
        app.state.problem_repository = problem_repository
        app.state.problem_cache_strategy = {
            "strategy": "file-mtime",
            "source": str(problem_repository.source_path),
        }

        startup_logger.debug(
            "refreshing template engine with concept=%s template=%s",
            sett\n... [truncated] ...\ntml=True),
            name="frontend",
        )
    else:
        startup_logger.debug("frontend bundle not found at %s; skipping mount", frontend_dir)

    # Store shared resources on the application state so routers can resolve them
    # without needing to be constructed dynamically during startup.
    app.state.settings = settings
    app.state.templates = templates
    app.state.frontend_available = frontend_available

    app.add_middleware(RequestContextMiddleware)

    # Older router modules exposed a factory (``get_router``) so we gracefully
    # support both patterns to avoid merge conflicts when downstream branches
    # still rely on the function based API.
    page_router = (
        pages.get_router(templates) if hasattr(pages, "get_router") else pages.router
    )
    invite_router = (
        invites.get_router(templates)
        if hasattr(invites, "get_router")
        else invites.router
    )

    app.include_router(health.router)
    app.include_router(bridge.router)
    app.include_router(page_router)
    app.include_router(invite_router)
    app.include_router(problems.router)
    app.include_router(practice.router)
    app.include_router(metrics.router)
    app.include_router(curriculum.router)
    app.include_router(dag.router)
    app.include_router(skill_problems.router)
    app.include_router(skills.router)

    @app.exception_handler(404)
    async def spa_fallback(
        request: Request, exc: StarletteHTTPException
    ):  # pragma: no cover - integration exercised in e2e
        accepts_html = "text/html" in (request.headers.get("accept") or "")
        if (
            frontend_available
            and frontend_index.exists()
            and request.method == "GET"
            and accepts_html
            and not request.url.path.startswith(("/api", "/static", "/docs", "/openapi"))
        ):
            return FileResponse(frontend_index)
        raise exc

    return app


app = create_app()


__all__ = ["create_app", "app"]
\n```\n\n#### app/config.py\n```\nfrom __future__ import annotations

import os
from dataclasses import dataclass
from functools import lru_cache
from pathlib import Path
from typing import List, Optional

SERVICE_ROOT = Path(__file__).resolve().parent
REPO_ROOT = SERVICE_ROOT.parent
DATA_DIR = (SERVICE_ROOT / "data").resolve()
LEGACY_DATA_DIR = (DATA_DIR / ".old").resolve()


def _default_data_file(filename: str) -> Path:
    primary = (DATA_DIR / filename).resolve()
    legacy = (LEGACY_DATA_DIR / filename).resolve()
    if primary.exists():
        return primary
    if legacy.exists():
        return legacy
    return primary


DEFAULT_DATA_PATH = _default_data_file("problems.json")
DEFAULT_DB_PATH = (DATA_DIR / "attempts.db").resolve()
DEFAULT_CONCEPT_PATH = _default_data_file("concepts.json")
DEFAULT_TEMPLATE_PATH = _default_data_file("templates.json")
DEFAULT_DAG_PATH = _default_data_file("dag.json")
DEFAULT_PROGRESS_PATH = _default_data_file("dag_progress.json")


def _load_env_file() -> None:
    """Populate process env vars from a local .env file if present."""

    env_path = REPO_ROOT / ".env"
    if not env_path.exists():
        return

    for raw_line in env_path.read_text(encoding="utf-8").splitlines():
        line = raw_line.strip()
        if not line or line.startswith("#"):
            continue
        if "=" not in line:
            continue
        key, value = line.split("=", 1)
        key = key.strip()
        value = value.strip().strip('"').strip("'")
        os.environ.setdefault(key, value)


def _parse_bool(value: str | None, default: bool) -> bool:
    if value is None:
        return default
    normalized = value.strip().lower()
    if normalized in {"1", "true", "yes", "on"}:
        return True
    if normalized in {"0", "false", "no", "off"}:
        return False
    return default


def _parse_int(value: str | None, default: int) -> int:
    if value is None or not value.strip():
        return default
    try:
        return int(value)
    except ValueError:
 \n... [truncated] ...\nl(os.getenv("ENABLE_OPENAPI"), True),
        allowed_problem_categories=_parse_categories(os.getenv("ALLOWED_PROBLEM_CATEGORIES")),
        invite_token_ttl_minutes=_parse_int(os.getenv("INVITE_TOKEN_TTL_MINUTES"), 180),
        invite_token_bytes=_parse_int(os.getenv("INVITE_TOKEN_BYTES"), 16),
        session_token_secret=os.getenv("SESSION_TOKEN_SECRET", "calculate-dev-secret"),
        session_token_ttl_minutes=_parse_int(os.getenv("SESSION_TOKEN_TTL_MINUTES"), 60),
        session_cookie_name=os.getenv("SESSION_COOKIE_NAME", "session_token"),
        session_cookie_secure=_parse_bool(os.getenv("SESSION_COOKIE_SECURE"), True),
        session_cookie_samesite=_parse_samesite(os.getenv("SESSION_COOKIE_SAMESITE"), "strict"),
        problem_data_path=_resolve_path(os.getenv("PROBLEM_DATA_PATH"), default=DEFAULT_DATA_PATH),
        attempts_database_path=_resolve_path(os.getenv("ATTEMPTS_DATABASE_PATH"), default=DEFAULT_DB_PATH),
        concept_data_path=_resolve_path(os.getenv("CONCEPT_DATA_PATH"), default=DEFAULT_CONCEPT_PATH),
        template_data_path=_resolve_path(os.getenv("TEMPLATE_DATA_PATH"), default=DEFAULT_TEMPLATE_PATH),
        dag_data_path=_resolve_path(os.getenv("DAG_DATA_PATH"), default=DEFAULT_DAG_PATH),
        progress_data_path=_resolve_path(os.getenv("DAG_PROGRESS_PATH"), default=DEFAULT_PROGRESS_PATH),
        skill_tree_list_rollout_percentage=_clamp_percentage(os.getenv("SKILL_TREE_LIST_ROLLOUT"), default=50),
        external_hub_url=_parse_optional_str(os.getenv("HUB_URL")),
        password_pepper=os.getenv("PASSWORD_PEPPER", "calculate-pepper"),
        login_rate_limit_attempts=_parse_positive_int(os.getenv("LOGIN_RATE_LIMIT_ATTEMPTS"), 5),
        login_rate_limit_window_seconds=_parse_positive_int(
            os.getenv("LOGIN_RATE_LIMIT_WINDOW_SECONDS"), 60
        ),
    )


@lru_cache
def get_settings() -> Settings:
    """Return cached settings instance."""

    return _build_settings()


__all__ = ["Settings", "get_settings"]
\n```\n\n#### app/routers/practice.py\n```\ndiff --git a/app/routers/practice.py b/app/routers/practice.py
index 177e804..e4de8c9 100644
--- a/app/routers/practice.py
+++ b/app/routers/practice.py
@@ -1,24 +1,34 @@
-from __future__ import annotations
-
-import hashlib
-import random
-import time
+from __future__ import annotations
+
+import hashlib
+import logging
+import random
+import time
 from dataclasses import dataclass
 from enum import Enum
 from typing import List, Optional
-
-from fastapi import APIRouter, Depends, HTTPException, Request, Response, status
-from pydantic import BaseModel, Field
-
-from ..dependencies.auth import (
-    SessionTokenService,
-    get_current_user,
-    get_session_token_service,
-    get_user_repository,
-)
-from ..repositories import UserRecord, UserRepository
-
+ 
+from fastapi import APIRouter, Depends, HTTPException, Request, Response, status
+from pydantic import BaseModel, Field
+
+from ..config import Settings, get_settings
+from ..dependencies.auth import (
+    SessionTokenService,
+    get_current_user,
+    get_session_token_service,
+    get_user_repository,
+)
+from ..repositories import UserRecord, UserRepository
+from ..security.passwords import (
+    hash_password as secure_hash_password,
+    is_argon_hash,
+    needs_rehash,
+    verify_password,
+)
+from ..security.rate_limiter import SlidingWindowRateLimiter
+
 router = APIRouter(prefix="/api", tags=["practice"])
+login_logger = logging.getLogger("calculate_service.api.login")
@@
-class SessionResponse(BaseModel):
-    session_id: int
-    problems: List[SessionProblem]
-
-
-def _hash_password(raw: str) -> str:
-    return hashlib.sha256(raw.encode("utf-8")).hexdigest()
-
-
-def _set_session_cookie(
-    response: Response, session_service: SessionTokenService, token: str
-) -> None:
-    response.set_cookie(
-        key=session_service.cookie_name,
-        value=token,
-        httponly=True,
-        secure=session_service.cookie_secure,
-        samesite="lax",
-        max_age=session_service\n... [truncated] ...\nwn"
+    if not limiter.allow(client_ip):
+        login_logger.warning("login rate limit exceeded", extra={"client_ip": client_ip})
+        raise HTTPException(
+            status_code=status.HTTP_429_TOO_MANY_REQUESTS,
+            detail={"message": "ë¡œê·¸ì¸ ì‹œë„ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."},
+        )
+
+    existing = repository.get_by_nickname(normalized_nickname)
+    pepper = settings.password_pepper
+
+    if existing is None:
+        created = repository.create_user(
+            nickname=normalized_nickname,
+            password_hash=secure_hash_password(payload.password, pepper=pepper),
+            role="student",
+        )
+        session_token, session_record = session_service.issue_session(
+            user_id=created.id,
+            user_agent=request.headers.get("user-agent"),
+        )
+        _set_session_cookie(response, request, session_service, session_token)
+        return LoginResponse(
+            user_id=created.id,
+            nickname=created.nickname,
+            role=created.role,
+            message="ìƒˆ ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
+            session_token=session_token,
+            expires_at=session_record.expires_at.timestamp(),
+        )
+
+    if not _verify_and_upgrade_password(
+        password=payload.password,
+        record=existing,
+        repository=repository,
+        pepper=pepper,
+    ):
+        raise HTTPException(
+            status_code=status.HTTP_401_UNAUTHORIZED,
+            detail={"message": "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."},
+        )
+
+    session_token, session_record = session_service.issue_session(
+        user_id=existing.id,
+        user_agent=request.headers.get("user-agent"),
+    )
+    _set_session_cookie(response, request, session_service, session_token)
+    return LoginResponse(
+        user_id=existing.id,
+        nickname=existing.nickname,
+        role=existing.role,
+        message="ë¡œê·¸ì¸ ì„±ê³µ",
+        session_token=session_token,
+        expires_at=session_record.expires_at.timestamp(),
+    )
\n```\n\n#### app/routers/skills.py\n```\nfrom __future__ import annotations

import json
import logging
from copy import deepcopy
from functools import lru_cache
from pathlib import Path
from typing import Any, Dict, Optional

from fastapi import APIRouter, Depends, HTTPException, Query, Request, Response, status
from pydantic import BaseModel, Field

from ..bipartite_loader import (
    BipartiteSpecError,
    get_atomic_skills,
    get_bipartite_graph,
    get_course_steps,
)
from ..dependencies.auth import get_optional_user
from ..feature_flags import assign_skill_tree_variant
from ..progress_store import (
    NodeProgress,
    ProgressSnapshot,
    ProgressStore,
    SkillProgress,
    get_progress_store,
)
from ..repositories import UserRecord
from ..services import SkillProgressService
from ..services.skill_tree_projection import build_skill_tree_projection
from ..services.skill_ui_layout import build_ui_layout_from_projection
from ..skills_loader import SkillSpecError

router = APIRouter(prefix="/api/v1", tags=["skills"])
logger = logging.getLogger("calculate_service.api.skills")

_SKILL_UI_PATH = Path(__file__).resolve().parent.parent / "data" / "skills.ui.json"
_LEGACY_SKILL_UI_PATH = _SKILL_UI_PATH.parent / ".old" / _SKILL_UI_PATH.name


def _resolve_skill_ui_path() -> Path | None:
    if _SKILL_UI_PATH.exists():
        return _SKILL_UI_PATH
    if _LEGACY_SKILL_UI_PATH.exists():
        return _LEGACY_SKILL_UI_PATH
    return None


@lru_cache(maxsize=1)
def _load_skill_ui_graph() -> Dict[str, Any]:
    source_path = _resolve_skill_ui_path()
    if source_path is None:
        raise SkillSpecError(
            f"Skill UI graph not found (searched {_SKILL_UI_PATH} and {_LEGACY_SKILL_UI_PATH})"
        )
    try:
        payload = json.loads(source_path.read_text(encoding="utf-8"))
    except json.JSONDecodeError as exc:  # pragma: no cover - defensive guard
        raise SkillSpecError(f"Invalid skill UI graph specification at {source_path}") from exc
    return payload


class SkillProgressReq\n... [truncated] ...\n.",
                "kind": progress_error.__class__.__name__,
            }
        )
    if graph_error is not None:
        graph_issue: dict[str, Any] = {
            "message": "UI ë ˆì´ì•„ì›ƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•´ ê¸°ë³¸ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤.",
            "kind": graph_error.__class__.__name__,
            "detail": str(graph_error),
        }
        if fallback_reason is not None:
            graph_issue["meta"] = {"fallback_reason": fallback_reason}
        issues.append(graph_issue)
    if issues:
        combined_issue = issues[0]
        if len(issues) > 1:
            combined_issue["causes"] = issues[1:]
        payload["error"] = combined_issue

    return payload


@router.post("/skills/progress")
async def api_update_skill_progress(
    request: Request,
    payload: SkillProgressRequest,
    user: UserRecord | None = Depends(get_optional_user),
) -> Dict[str, Any]:
    bipartite_graph = get_bipartite_graph()
    course_steps = get_course_steps()
    atomic_skills = get_atomic_skills()
    service = SkillProgressService(course_steps, atomic_skills, bipartite_graph.edges)
    store = _resolve_progress_store(request)

    effective_user_id = payload.user_id or (user.id if user else None)
    if effective_user_id is None:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail={"message": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."},
        )

    def mutator(snapshot: ProgressSnapshot) -> None:
        for _ in range(payload.attempts):
            service.apply_course_attempt(snapshot, payload.course_step_id, correct=payload.correct)

    snapshot = store.update_snapshot(effective_user_id, mutator)
    return {
        "user_id": snapshot.user_id,
        "updated_at": snapshot.updated_at.isoformat(),
        "total_xp": snapshot.total_xp,
        "nodes": {node_id: progress.dict() for node_id, progress in snapshot.nodes.items()},
        "skills": {skill_id: progress.dict() for skill_id, progress in snapshot.skills.items()},
    }


__all__ = ["router"]
\n```\n\n#### frontend/src/components/SkillTreePage.tsx\n```\ndiff --git a/frontend/src/components/SkillTreePage.tsx b/frontend/src/components/SkillTreePage.tsx
index 6b450b0..a270484 100644
--- a/frontend/src/components/SkillTreePage.tsx
+++ b/frontend/src/components/SkillTreePage.tsx
@@ -227,6 +227,8 @@ const SkillTreePage: React.FC = () => {
   const [experiment, setExperiment] = useState<ExperimentAssignment | null>(null);
   const [selectedNodeId, setSelectedNodeId] = useState<string | null>(null);
   const [isSimpleSkillTree, setIsSimpleSkillTree] = useState(false);
+  const [seedDiagnostics, setSeedDiagnostics] =
+    useState<SkillTreeResponse['diagnostics'] | null>(null);
   const isMountedRef = useRef(true);
   const [isRefreshing, setIsRefreshing] = useState(false);
   const [zoom, setZoom] = useState(1);
@@ -312,6 +314,9 @@ useUnlockFx(recentlyUnlocked);
         setProgress(createEmptyProgress());
         setExperiment(null);
         setIsSimpleSkillTree(true);
+        setSeedDiagnostics(
+          payload.diagnostics?.fallback === 'seed' ? payload.diagnostics : null,
+        );
         setError(null);
         if (!silent) {
           setSelectedNodeId(null);
@@ -321,6 +326,7 @@ useUnlockFx(recentlyUnlocked);
       }
 
       setIsSimpleSkillTree(false);
+      setSeedDiagnostics(null);
       setVersion(payload.version ?? null);
       setPalette(payload.palette ?? {});
       const nodeList = Array.isArray(payload.nodes) ? payload.nodes : [];
@@ -423,6 +429,7 @@ useUnlockFx(recentlyUnlocked);
     registerCourseConcept,
     trackExperimentExposure,
     fetchSkillTree,
+    setSeedDiagnostics,
   ],
 );
 
@@ -747,7 +754,24 @@ useEffect(() => {
 
       {isSimpleSkillTree ? (
         <div className="rounded-2xl border border-amber-500/40 bg-amber-500/10 p-3 text-xs text-amber-100">
-          ì‹œì‘ìš© ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì„ í–‰ ê´€ê³„ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆê³ , í•™ìŠµ ì‹œì‘ì€ ì¶”í›„ ë‹¨ê³„ë³„ ì—…ë°ì´íŠ¸ì™€ í•¨ê»˜ í™œì„±í™”ë©ë‹ˆë‹¤.
+          <p>
+            {(() => {
+              const reason = seedDiagnostics?.reason ?? 'seed_mode';
+              if (reason === 'api_error') {
+                return 'ë¼ì´ë¸Œ ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•´ ì‹œë“œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.';
+              }
+              if (reason === 'graph_unavailable') {
+                return 'ì„œë²„ì—ì„œ UI ë ˆì´ì•„ì›ƒì´ ë¹„ì–´ ìˆì–´ ì‹œë“œ ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ ì„ì‹œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.';
+              }
+              if (reason === 'nodes_unavailable') {
+                return 'ìŠ¤í‚¬ ë…¸ë“œê°€ ë¹„ì–´ ìˆì–´ ì‹œë“œ ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ ì„ì‹œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.';
+              }
+              return 'ì‹œì‘ìš© ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.';
+            })()}
+          </p>
+          <p className="mt-1 text-[11px] text-amber-200/80">
+            ë¼ì´ë¸Œ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìµœì‹  ê²½ë¡œÂ·ì§„í–‰ë„ë¥¼ í™•ì¸í•˜ì„¸ìš”. fallback ë°œìƒì€ í…”ë ˆë©”íŠ¸ë¦¬ì— ê¸°ë¡ë˜ì–´ ìš´ì˜íŒ€ì´ ì¦‰ì‹œ ì¶”ì í•©ë‹ˆë‹¤.
+          </p>
         </div>
       ) : null}
 
\n```\n\n#### frontend/src/utils/api.ts\n```\ndiff --git a/frontend/src/utils/api.ts b/frontend/src/utils/api.ts
index a4bc687..222ad2d 100644
--- a/frontend/src/utils/api.ts
+++ b/frontend/src/utils/api.ts
@@ -16,6 +16,7 @@ import type {
 } from '../types';
 import { STARTER_SKILL_TREE, SKILL_TREE_SEED_VERSION } from '../constants/skillTreeSeed';
 import { buildSimpleSkillTree } from './simpleSkillTree';
+import { trackApiError, trackSkillTreeFallback } from './analytics';
 
 export const API_BASE_URL = import.meta.env.VITE_API_BASE_URL ?? '/api';
 
@@ -38,33 +39,30 @@ async function apiCall<T>(endpoint: string, options?: RequestInit): Promise<T> {
   });
 
   if (!response.ok) {
-    let bodyPreview: string | undefined;
-    try {
-      const text = await response.clone().text();
-      bodyPreview = text.trim().slice(0, 200);
-    } catch (error) {
-      bodyPreview = undefined;
-    }
+    const requestId = response.headers.get('x-request-id');
     console.error('[API] í˜¸ì¶œ ì‹¤íŒ¨', {
       url,
       status: response.status,
       statusText: response.statusText,
-      bodyPreview,
+      requestId,
+    });
+    trackApiError({
+      endpoint,
+      method: options?.method ?? 'GET',
+      status: response.status,
+      requestId,
     });
-    throw new Error(
-      `API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText} @ ${url}${
-        bodyPreview ? ` â†’ ${bodyPreview}` : ''
-      }`,
-    );
+    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText} @ ${url}`);
   }
 
   return response.json();
 }
 
-// ê¸°ë³¸ê°’ì„ liveë¡œ ì˜¬ë ¤ì„œ ë°±ì—”ë“œ íŠ¸ë¦¬ë¥¼ ìš°ì„  ì‚¬ìš©í•˜ê³ , seedëŠ” ëª…ì‹œì ìœ¼ë¡œë§Œ í™œì„±í™”í•œë‹¤.
-const skillTreeMode = (import.meta.env.VITE_SKILL_TREE_MODE ?? 'live').toLowerCase();
+const rawSkillTreeMode = (import.meta.env.VITE_SKILL_TREE_MODE ?? 'auto-seed').toLowerCase();
+const supportedModes = new Set(['live', 'seed', 'auto-seed']);
+const skillTreeMode = supportedModes.has(rawSkillTreeMode) ? rawSkillTreeMode : 'auto-seed';
 const useSeedSkillTree = skillTreeMode === 'seed';
-const allowSeedFallback = useSeedSkillTr\n... [truncated] ...\n@ -95,6 +93,26 @@ const seedSkillTreePayload: SkillTreeResponse = {
   },
 };
 
+type SeedFallbackReason = 'seed_mode' | 'api_error' | 'graph_unavailable' | 'nodes_unavailable';
+
+const createSeedPayload = (reason: SeedFallbackReason, detail?: string): SkillTreeResponse => ({
+  ...seedSkillTreePayload,
+  diagnostics: {
+    fallback: 'seed',
+    reason,
+    mode: skillTreeMode,
+    detail,
+  },
+});
+
+const reportSeedFallback = (reason: SeedFallbackReason, detail?: string) => {
+  trackSkillTreeFallback({
+    reason,
+    mode: skillTreeMode,
+    detail,
+  });
+};
+
 // ì„¸ì…˜ ìƒì„± (20ë¬¸ì œ ì„¸íŠ¸)
 export async function createSession(
   token?: string,
@@ -245,14 +263,26 @@ export async function fetchLatestLRC(userId: string): Promise<LRCEvaluation | nu
 export async function fetchSkillTree(): Promise<SkillTreeResponse> {
   if (useSeedSkillTree) {
     console.info('[API] ìŠ¤í‚¬ íŠ¸ë¦¬ë¥¼ ì‹œë“œ ë°ì´í„°ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.');
-    return seedSkillTreePayload;
+    reportSeedFallback('seed_mode');
+    return createSeedPayload('seed_mode');
   }
   try {
-    return await apiCall<SkillTreeResponse>('/v1/skills/tree');
+    const payload = await apiCall<SkillTreeResponse>('/v1/skills/tree');
+    const hasNodes = Array.isArray(payload.nodes) && payload.nodes.length > 0;
+    const hasGraphNodes =
+      Array.isArray(payload.graph?.nodes) && (payload.graph?.nodes?.length ?? 0) > 0;
+    if ((!hasNodes || !hasGraphNodes) && allowSeedFallback) {
+      const reason: SeedFallbackReason = hasNodes ? 'graph_unavailable' : 'nodes_unavailable';
+      reportSeedFallback(reason);
+      return createSeedPayload(reason);
+    }
+    return payload;
   } catch (error) {
     if (allowSeedFallback) {
       console.warn('[API] ìŠ¤í‚¬ íŠ¸ë¦¬ API í˜¸ì¶œ ì‹¤íŒ¨ â†’ ì‹œë“œ ë°ì´í„°ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.', error);
-      return seedSkillTreePayload;
+      const detail = error instanceof Error ? error.message : undefined;
+      reportSeedFallback('api_error', detail);
+      return createSeedPayload('api_error', detail);
     }
     throw error;
   }
\n```\n\n#### tasks/2025-12-02-1_handoff.json\n```\n{
  "task_id": "2025-12-02-1",
  "title": "ìŠ¤í‚¬ íŠ¸ë¦¬ ë°ì´í„°/ì¸ì¦ ë³µêµ¬ ë° í”„ëŸ°íŠ¸ fallback ì ìš©",
  "description": "í•„ìˆ˜ ë°ì´í„°(JSON) ëˆ„ë½ìœ¼ë¡œ ë°±ì—”ë“œ ê¸°ë™ê³¼ /api/v1/skills/treeê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ë¹ˆ payloadë¥¼ ë‚´ë ¤ í”„ëŸ°íŠ¸ê°€ ë¹„ì–´ ë³´ì´ëŠ” ë¬¸ì œë¥¼ í•´ì†Œí•˜ê³ , ë¡œê·¸ì¸ ë³´ì•ˆì„ ê°•í™”í•˜ë©° í”„ëŸ°íŠ¸ SkillTreePageì— seed/auto-seed fallbackì„ ê¸°ë³¸ ì ìš©í•©ë‹ˆë‹¤.",
  "required_roles_for_signoff": [
    "backend",
    "frontend",
    "security",
    "qa_release",
    "senior_engineer"
  ],
  "chain": [
    {
      "owner": "backend",
      "task": ".oldì˜ problems/dag/dag_progress/skills.ui JSONì„ ê¸°ë³¸ ê²½ë¡œë¡œ ì´ë™í•˜ê±°ë‚˜ ê¸°ë³¸ê°’ì„ ìˆ˜ì •í•˜ê³ , ë¯¸ì¡´ì¬ ì‹œ ì•ˆì „í•œ fallback ì²˜ë¦¬"
    },
    {
      "owner": "backend",
      "task": "/api/v1/skills/treeì— skills.ui.jsonì´ ì—†ì„ ë•Œ bipartite projectionì„ graphë¡œ ë‚´ë ¤ì£¼ëŠ” fallbackê³¼ ë ˆì´ì•„ì›ƒ ìƒì„± ìŠ¤í¬ë¦½íŠ¸/ë¬¸ì„œ ì¶”ê°€"
    },
    {
      "owner": "security",
      "task": "ë¡œê·¸ì¸ í•´ì‹œë¥¼ bcrypt/argon2ë¡œ êµì²´í•˜ê³  SESSION_COOKIE_SECURE ê¸°ë³¸ True, ë¡œê·¸ì¸ rate limit ì ìš©"
    },
    {
      "owner": "frontend",
      "task": "SkillTreePage ê¸°ë³¸ ëª¨ë“œë¥¼ auto-seedë¡œ ë‘ê³  API ì‹¤íŒ¨/ë¹ˆ ê·¸ë˜í”„ ì‹œ seed íŠ¸ë¦¬ì™€ ì•ˆë‚´ë¥¼ í‘œì‹œ, ì„œë²„ ì œê³µ ë ˆì´ì•„ì›ƒì„ ìš°ì„  ì‚¬ìš©í•´ ELK ì˜ì¡´ì„ ì¤„ì„"
    },
    {
      "owner": "qa_release",
      "task": "í´ë¦° í™˜ê²½ì—ì„œ /readyzì™€ /api/v1/skills/tree ì‘ë‹µ ê²€ì¦ ë° ë¡œê·¸ì¸/ìŠ¤í‚¬ íŠ¸ë¦¬ íšŒê·€ í…ŒìŠ¤íŠ¸"
    },
    {
      "owner": "senior_engineer",
      "task": "ìµœì¢… í†µí•© ë¦¬ë·° ë° ìŠ¹ì¸"
    }
  ],
  "artifacts": [
    {
      "type": "report",
      "uri": "tasks/2025-12-02-1_handoff.json",
      "status": "draft"
    }
  ],
  "priority": "high",
  "deadline": "2025-12-09",
  "created_at": "2025-12-02T00:00:00",
  "created_by": "senior_engineer"
}
\n```

### IMPORTANT
ë°˜ë“œì‹œ JSON í•˜ë‚˜ë§Œ ì¶œë ¥. ìì—°ì–´/ì½”ë“œë¸”ë¡ ê¸ˆì§€.