{"task_id":"Task 2025-12-03-1","owner_role":"planner_spec","status":"ok","decision":"approve","spec_md":"# Task 2025-12-03-1 — Skill Tree UX Alignment\n\n## 1. Overview\n- **Problem**: Current Skill Tree graph renders with fixed widths, cramped spacing, inaccurate edges, and disjointed student flows between `/student`, `/skills`, and `/game`.\n- **Goal**: Deliver a unified, responsive skill exploration and practice experience that auto-fits large DAGs, preserves hover clarity, and links dashboard CTAs to the selected skill context.\n- **Success Metrics**: (a) ≥90% of QA scenarios confirm full-graph visibility without manual zoom on 1280×720+ screens; (b) node hover tooltips remain unobstructed in usability tests; (c) session launch telemetry shows ≥80% of “수학 게임 시작하기” clicks include a skill_id payload; (d) dashboard and Skill Tree tier labels match in all locales.\n\n## 2. Scope\n- Frontend components: `frontend/src/components/SkillTreeGraph.tsx`, surrounding layout, dashboard entry pages (`/student`, `/skills`).\n- Interaction glue between dashboard CTAs and practice session routes.\n- Optional UX artifacts (collapsible panel, confirmation modal) live in frontend only.\n- Out of scope: backend practice content generation, telemetry plumbing, authentication changes.\n\n## 3. User & Journey\n- **Primary persona**: Students navigating skills roadmap before and during practice sessions on desktop/laptop (≥1280px) and tablets (≥1024px landscape).\n- **Secondary persona**: Teachers verifying tier progress.\n- **Key flows**:\n  1. Student lands on dashboard → sees Diablo-style Skill Tree as hero content → selects a skill → reviews tooltip → starts practice → confirmation modal outlines prerequisites → session opens with selected skill context.\n  2. Student resizes viewport; graph auto-scales while preserving readability.\n\n## 4. Functional Requirements\n### 4.1 Graph Layout & Responsiveness\n- **FR1**: Replace constants `PANEL_WIDTH`, `NODE_COLUMN_SPACING`, `ROW_GAP` with viewport/tier-aware calculations. Graph must call `fitView` (or equivalent) on mount and after resize to ensure all tiers visible without manual zoom.\n- **FR2**: Implement a layout observer: when selected-panel width exceeds 30% of viewport and available width < 1024px, collapse panel into overlay or toggleable drawer; graph re-measures and re-fits.\n- **FR3**: Node spacing algorithm must guarantee ≥24px spacing between tooltip bounding boxes and adjacent nodes at default zoom.\n\n### 4.2 Interaction & Visual Polish\n- **FR4**: Hover/focus states enlarge hitbox to minimum 200×140px area, display tooltip/panel above other nodes via layered portal, and dim unrelated nodes/edges (e.g., opacity 40%).\n- **FR5**: Edge renderer must compute start/end anchors at node boundaries using slope-based ports; arrows terminate flush with node border and include arrowheads. Bundled edges should curve without overlapping tooltips.\n- **FR6**: Tooltip content displays tier, XP, requirements, teaches, progress summary, and CTA button labeled “학습 시작”. Tooltip never clips outside viewport (flip strategy at edges).\n\n### 4.3 Unified Student Flow\n- **FR7**: `/student` page loads Skill Tree as primary hero or directly routes to `/skills`. Legacy HomePath map is removed or demoted; any residual HomePath widget must derive tier labels from current DAG tiers instead of static `STEP_ORDER`.\n- **FR8**: “수학 게임 시작하기” / “연습 시작” CTA passes the currently selected skill_id and prerequisites to the practice session route (`/game` or replacement) via query params or body payload expected by existing practice API.\n- **FR9**: Implement pre-session confirmation modal summarizing skill title, tier, prerequisites completion status, and expected problem types with primary action to continue.\n\n### 4.4 Data Consistency\n- **FR10**: Both dashboard and Skill Tree surfaces read tier labels from a single source (e.g., DAG metadata) ensuring translated strings (e.g., Diablo tier names) stay in sync.\n\n## 5. Non-Functional Requirements\n- **Performance**: Graph render and auto-fit must complete within 500 ms on mid-tier laptops (Chrome 122) for DAGs ≤200 nodes. Hover dimming transitions ≤100 ms.\n- **Responsiveness**: UX supports 1280×720 desktops and 1024px-wide tablets; small screens may degrade gracefully but must not break layout.\n- **Accessibility**: Tooltips focusable via keyboard; confirmation modal meets WCAG 2.1 AA (focus trap, aria labels). High-contrast mode retains visibility of dimming treatment.\n- **Security/Privacy**: No new PII stored. Ensure skill selections passed to session API do not expose hidden skills. Confirmation modal data uses existing auth context.\n- **Observability**: Emit analytics events for `skill_tree_auto_fit`, `skill_launch_confirmed`, and `dashboard_tier_mismatch` errors for monitoring.\n- **Reliability**: Viewport auto-fit must gracefully retry on resize debounced ≤150 ms.\n\n## 6. Acceptance Criteria Traceability\n- AC1 ↔ FR1/FR2 (auto-fit, responsive panel).\n- AC2 ↔ FR3/FR4/FR6 (hover clarity, dimming).\n- AC3 ↔ FR5 (edges terminate on nodes).\n- AC4 ↔ FR8/FR9 (session scoped to selected skill, confirmation modal).\n- AC5 ↔ FR7/FR10 (dashboard tiers aligned).\n\n## 7. Test Plan Overview\n- **Layout tests**: Jest/React Testing Library snapshot verifying computed `fitView` parameters based on mock container sizes; Cypress visual diff across breakpoints.\n- **Interaction tests**: Simulate hover/focus to confirm tooltip portal layering and unrelated nodes opacity change; ensure arrow anchors computed using node bounds.\n- **Flow tests**: Cypress end-to-end from `/student` CTA through confirmation modal to session route with asserted skill_id payload.\n- **Regression tests**: Ensure high-contrast mode toggles do not hide dimmed nodes; verify fallback when ELK layout fails.\n\n## 8. Risks & Mitigations\n- **R1**: Performance may degrade with auto-fit recalculations on resize → debounce resize handler and memoize layout.\n- **R2**: Merging `/student` and `/skills` may disrupt teacher workflows → provide feature flag or staged rollout.\n- **R3**: Practice API payload mismatch → coordinate contract test with backend before release.\n\n## 9. Assumptions\n- Existing practice session API already accepts a skill identifier parameter.\n- DAG metadata exposes tier labels usable across dashboard and Skill Tree.\n- React Flow (or equivalent) layout utilities are available in bundle or can be added without major dependency bloat.\n\n## 10. Open Questions\n1. Should `/student` fully redirect to `/skills`, or should Skill Tree be embedded within `/student` while retaining other dashboard widgets?\n2. What is the minimum supported viewport height for auto-fit calculations (e.g., 640px vs 720px)?\n3. Are there localization requirements for the confirmation modal content beyond current language support?\n4. Should the confirmation modal allow selecting practice difficulty or attempt count before launching?\n\n## 11. Rollout & Metrics\n- Feature flag `skill_tree_unified_flow` gating dashboard changes.\n- Monitor session analytics to ensure increased engagement and decreased bounce between `/student` and `/skills`.\n","acceptance_criteria":["Graph auto-fits on load and resize, showing all tiers without manual zoom on ≥1280×720 viewports.","Selected skill panel collapses or overlays on small widths without clipping the graph.","Hover/focus tooltips render above other nodes, never overlap neighbors, and dim unrelated nodes.","Connector arrows originate/terminate on node boundaries with visible arrowheads and no mid-air endpoints.","Dashboard entry (“수학 게임 시작하기”) launches practice scoped to the currently selected skill via skill_id payload.","Dashboard/HomePath visual tiers match Skill Tree tiers—legacy S1/S2/S3 labels removed or derived from new tier data.","Confirmation modal appears before practice, summarizing skill + prerequisites, and proceeds only when confirmed."],"open_questions":["Should `/student` redirect to `/skills` or embed the Skill Tree within dashboard chrome?","What minimum viewport height should auto-fit target for QA sign-off?","Is additional localization needed for the confirmation modal copy?","Should learners configure practice difficulty/length within the confirmation modal?"],"assumptions":["Practice API already supports passing skill_id to scope sessions.","Tier metadata is centralized and accessible to both dashboard and Skill Tree components.","React Flow or equivalent viewport utilities can be adopted without backend changes."],"risks":["Auto-fit recalculation might hurt performance on large DAGs; mitigated via debounce and memoization.","Unifying `/student` and `/skills` could confuse existing user habits; requires staged rollout/UX comms.","Passing skill_id without backend validation could expose hidden skills; ensure backend enforces permission checks."],"artifacts_out":[{"type":"spec","uri":"docs/specs/Task-2025-12-03-1/spec_v1.md"}],"notes":["Spec captures responsive layout, hover polish, unified flow, modal requirements; reviewers should focus on feasibility of viewport auto-fit and confirmation modal scope.","Need UX/PM decision on dashboard vs `/skills` ownership (see open questions)."]}
